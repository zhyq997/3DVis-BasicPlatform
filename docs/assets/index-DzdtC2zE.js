import{z as J,p as j,e5 as Z}from"./entry/index-BNp4bmLj-1732066199007.js";import{ad as y,l as K,aJ as Q,aO as ee,aP as te}from"./antd-DgCI0x_J.js";import{d as k,c as L,Z as I,_ as W,k as o,a9 as w,u as i,a1 as ne,ae as oe,F as se,aa as ae,a8 as G,ad as re,ac as E,r as ie,f as P,h as le,G as Y,x as ce,a7 as ue}from"./vue-D4H2Ux2Y.js";import{P as me}from"./index-3FyLWnMM.js";import"./useContentViewHeight-B2xTi02b.js";import"./useWindowSizeFn-Wb2xO1po.js";import"./onMountedOrActivated-B_y9TM8l.js";const de=k({name:"ImagePreview",__name:"Preview",props:{functional:J.bool,imageList:{type:Array}},setup(n){const c=y.PreviewGroup,u=n,{prefixCls:m}=j("image-preview"),t=L(()=>{const{imageList:l}=u;return l?l.map(d=>K(d)?{src:d,placeholder:!1}:d):[]});return(l,d)=>(I(),W("div",{class:ne(i(m))},[o(i(c),null,{default:w(()=>[!n.imageList||l.$slots.default?oe(l.$slots,"default",{key:0}):(I(!0),W(se,{key:1},ae(t.value,f=>(I(),G(i(y),E({key:f.src,ref_for:!0},f),re({_:2},[f.placeholder?{name:"placeholder",fn:w(()=>[o(i(y),E({ref_for:!0},f,{src:f.placeholder,preview:!1}),null,16,["src"])]),key:"0"}:void 0]),1040))),128))]),_:3})],2))}}),ge="/assets/resume-B3WqOnYy.svg",fe="/assets/p-rotate-B8E2YvbH.svg",ve="/assets/scale-DVqu0Dc8.svg",pe="/assets/unscale-CHGHM79W.svg",he="/assets/unrotate-JenR5WXc.svg";var v=function(n){return n[n.LOADING=0]="LOADING",n[n.DONE=1]="DONE",n[n.FAIL=2]="FAIL",n}(v||{});const _e={show:{type:Boolean,default:!1},imageList:{type:Array,default:null},index:{type:Number,default:0},scaleStep:{type:Number},defaultWidth:{type:Number},maskClosable:{type:Boolean},rememberState:{type:Boolean}},a="img-preview",Le=k({name:"ImagePreview",props:_e,emits:["img-load","img-error"],setup(n,{expose:c,emit:u}){const m=new Map,t=ie({currentUrl:"",imgScale:1,imgRotate:0,imgTop:0,imgLeft:0,status:v.LOADING,currentIndex:0,moveX:0,moveY:0,show:n.show}),l=P(null),d=P(null);function f(){F();const{index:e,imageList:s}=n;if(!s||!s.length)throw new Error("imageList is undefined");t.currentIndex=e,D(s[e])}function S(){t.imgScale=1,t.imgRotate=0,t.imgTop=0,t.imgLeft=0}function F(){const e=i(l);e&&(e.onmousewheel=x,document.body.addEventListener("DOMMouseScroll",x),document.ondragstart=function(){return!1})}const h=L(()=>{var s;const e=(s=n==null?void 0:n.scaleStep)!=null?s:0;return e!=null&&e?e/100:t.imgScale/10});function x(e){e=e||window.event,e.delta=e.wheelDelta||-e.detail,e.preventDefault(),e.delta>0&&_(h.value),e.delta<0&&_(-h.value)}function _(e){t.imgScale<=.2&&e<0||(t.imgScale+=e*.1,t.imgScale<0&&(t.imgScale=.02))}function b(e){t.imgRotate+=e}function T(){const e=i(d);e&&(e.onmousemove=null)}function D(e){t.status=v.LOADING;const s=new Image;s.src=e,s.onload=r=>{if(t.currentUrl!==e){const g=r.composedPath();if(n.rememberState){m.set(t.currentUrl,{scale:t.imgScale,top:t.imgTop,left:t.imgLeft,rotate:t.imgRotate});const p=m.get(e);p?(t.imgScale=p.scale,t.imgTop=p.top,t.imgRotate=p.rotate,t.imgLeft=p.left):(S(),n.defaultWidth&&(t.imgScale=n.defaultWidth/g[0].naturalWidth))}else n.defaultWidth&&(t.imgScale=n.defaultWidth/g[0].naturalWidth);g&&u("img-load",{index:t.currentIndex,dom:g[0],url:e})}t.currentUrl=e,t.status=v.DONE},s.onerror=r=>{const g=r.composedPath();g&&u("img-error",{index:t.currentIndex,dom:g[0],url:e}),t.status=v.FAIL}}function M(e){e&&e.stopPropagation(),O()}function O(){t.show=!1,document.body.removeEventListener("DOMMouseScroll",x),document.ondragstart=null}function A(){S()}c({resume:A,close:O,prev:C.bind(null,"left"),next:C.bind(null,"right"),setScale:e=>{e>0&&e<=10&&(t.imgScale=e)},setRotate:e=>{t.imgRotate=e}});function C(e){const{currentIndex:s}=t,{imageList:r}=n;e==="left"&&(t.currentIndex--,s<=0&&(t.currentIndex=r.length-1)),e==="right"&&(t.currentIndex++,s>=r.length-1&&(t.currentIndex=0)),D(r[t.currentIndex])}function X(e){e=e||window.event,t.moveX=e.clientX,t.moveY=e.clientY;const s=i(d);s&&(s.onmousemove=B)}function B(e){e=e||window.event,e.preventDefault();const s=e.clientX-t.moveX,r=e.clientY-t.moveY;t.imgLeft+=s,t.imgTop+=r,t.moveX=e.clientX,t.moveY=e.clientY}const U=L(()=>{const{imgScale:e,imgRotate:s,imgTop:r,imgLeft:g}=t;return{transform:`scale(${e}) rotate(${s}deg)`,marginTop:`${r}px`,marginLeft:`${g}px`,maxWidth:n.defaultWidth?"unset":"100%"}}),N=L(()=>{const{imageList:e}=n;return e.length>1});le(()=>{n.show&&f(),n.imageList&&S()});const H=e=>{n.maskClosable&&e.target&&e.target.classList.contains(`${a}-content`)&&M(e)},V=()=>o("div",{class:`${a}__close`,onClick:M},[o(Q,{class:`${a}__close-icon`},null)]),q=()=>{if(!i(N))return null;const{currentIndex:e}=t,{imageList:s}=n;return o("div",{class:`${a}__index`},[e+1,Y(" / "),s.length])},z=()=>o("div",{class:`${a}__controller`},[o("div",{class:`${a}__controller-item`,onClick:()=>_(-h.value)},[o("img",{src:pe},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>_(h.value)},[o("img",{src:ve},null)]),o("div",{class:`${a}__controller-item`,onClick:A},[o("img",{src:ge},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>b(-90)},[o("img",{src:he},null)]),o("div",{class:`${a}__controller-item`,onClick:()=>b(90)},[o("img",{src:fe},null)])]),R=e=>i(N)?o("div",{class:[`${a}__arrow`,e],onClick:()=>C(e)},[e==="left"?o(ee,null,null):o(te,null,null)]):null;return()=>t.show&&o("div",{class:a,ref:l,onMouseup:T,onClick:H},[o("div",{class:`${a}-content`},[o("img",{style:i(U),class:[`${a}-image`,t.status===v.DONE?"":"hidden"],ref:d,src:t.currentUrl,onMousedown:X},null),V(),q(),z(),R("left"),R("right")])])}});let $=null;function Ie(n){var m;if(!Z)return;const c={},u=document.createElement("div");return Object.assign(c,{show:!0,index:0,scaleStep:100},n),$=o(Le,c),ce($,u),document.body.appendChild(u),(m=$.component)==null?void 0:m.exposed}const be=k({__name:"index",setup(n){const c=["https://picsum.photos/id/66/346/216","https://picsum.photos/id/67/346/216","https://picsum.photos/id/68/346/216"];function u(){Ie({imageList:c,defaultWidth:700,rememberState:!0,onImgLoad:({index:t,url:l,dom:d})=>{}})}return(m,t)=>{const l=ue("a-button");return I(),G(i(me),{title:"图片预览示例"},{default:w(()=>[o(i(de),{imageList:c}),o(l,{onClick:u,type:"primary"},{default:w(()=>[Y("无预览图")]),_:1})]),_:1})}}});export{be as default};
