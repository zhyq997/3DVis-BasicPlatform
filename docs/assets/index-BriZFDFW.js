var U=(o,i,s)=>new Promise((r,n)=>{var b=p=>{try{v(s.next(p))}catch(_){n(_)}},O=p=>{try{v(s.throw(p))}catch(_){n(_)}},v=p=>p.done?r(p.value):Promise.resolve(p.value).then(b,O);v((s=s.apply(o,i)).next())});import{d as Le,f as N,r as ke,o as Ce,b as je,a7 as C,Z as j,a8 as J,a9 as u,$ as l,k as g,G as Te,_ as A,F as Q,aa as Y,a1 as Ie,m as ee,A as te,a0 as ae,u as R,ab as q,a2 as Ne,a3 as Me}from"./vue-D4H2Ux2Y.js";import{m as d,$ as D,h as Pe,i as $e,_ as He}from"./entry/index-BNp4bmLj-1732066199007.js";import{aj as B}from"./antd-DgCI0x_J.js";import{u as xe}from"./use-lifecycle-CyVQVRUS.js";let y,c,h,f;const Je={scene:{center:{lat:31.628661,lng:117.251952,alt:46390,heading:2,pitch:-68}}},P=new d.BaseClass;function Ae(o){y=o,c=new d.layer.GraphicLayer({hasEdit:!0,isAutoEditing:!1}),y.addLayer(c),c.on(d.EventType.editStop,function(i){h=i.graphic})}function Re(){ne(),y=null}function ne(){V(),c.clear(),f=null,h=null,c=null}function oe(o,i){const s={name:o,center:y.getCameraView(),graphics:h==null?void 0:h.toJSON(),roamOptions:i};y.expImage({download:!1,width:300}).then(r=>{s.img=r.image,P.fire("addImgObject",{item:s})})}function G(o,i){const s={name:o,center:y.getCameraView(),graphics:h==null?void 0:h.toJSON(),roamOptions:i};y.expImage({download:!1,width:300}).then(r=>{s.img=r.image,P.fire("editImgObject",{item:s})})}function le(o){y.setCameraView(o,{duration:1})}function ie(){return U(this,null,function*(){return h=yield c.startDraw({type:"polyline",style:{color:"#ffff00",width:3,clampToGround:!0}}),h})}function se(o,i,s){return new Promise((r,n)=>{if(f=new d.graphic.FixedRoute({name:s,speed:i.speed,positions:o,clockLoop:i.clockLoop,interpolation:i.interpolation,camera:{type:i.camera.type,followedX:i.camera.followedX,radius:i.camera.radius}}),i.model&&(f.model=i.model),Ve(f,s),c.addGraphic(f),i.surfaceHeight)try{f.autoSurfaceHeight({exact:!0}).then(()=>{f.start(),f.openPopup(),r()}).catch(n)}catch(b){n(b)}else f.start(),f.openPopup()})}function V(){f&&(f.stop(),c.removeGraphic(f,!1))}function ce(o){o&&(h=o)}function Ve(o,i){o.bindPopup(`<div style="width: 200px">
      <div>线路名称：<span>${i}</span></div>
      <div>总 距 离：<span id="lblAllLen"> </span></div>
      <div>总 时 间：<span id="lblAllTime"> </span></div>
      <div>开始时间：<span id="lblStartTime"> </span></div>
      <div>剩余时间：<span id="lblRemainTime"> </span></div>
      <div>剩余距离：<span id="lblRemainLen"> </span></div>
    </div>`,{closeOnClick:!1}),o.on(d.EventType.popupRender,function(s){const r=s.container,n=o==null?void 0:o.info;if(!n)return;const b=r.querySelector("#lblAllLen");b&&(b.innerHTML=d.MeasureUtil.formatDistance(n.distance_all));const O=r.querySelector("#lblAllTime");O&&(O.innerHTML=d.Util.formatTime(n.second_all/y.clock.multiplier));const v=r.querySelector("#lblStartTime");v&&(v.innerHTML=d.Util.formatDate(Cesium.JulianDate.toDate(o.startTime),"yyyy-M-d HH:mm:ss"));const p=r.querySelector("#lblRemainTime");p&&(p.innerHTML=d.Util.formatTime((n.second_all-n.second)/y.clock.multiplier));const _=r.querySelector("#lblRemainLen");_&&(_.innerHTML=d.MeasureUtil.formatDistance(n.distance_all-n.distance)||"完成")})}const ze=Object.freeze(Object.defineProperty({__proto__:null,addTxtName:oe,clearAll:ne,drawPolyline:ie,editTxtName:G,eventTarget:P,get fixedRoute(){return f},flytoView:le,get graphic(){return h},get graphicLayer(){return c},get map(){return y},mapOptions:Je,onMounted:Ae,onUnmounted:Re,startRoam:se,stopRoam:V,updataGraphic:ce},Symbol.toStringTag,{value:"Module"})),w=o=>(Ne("data-v-3f992050"),o=o(),Me(),o),Ee={class:"f-mb f-tac"},Ue={class:"bookmarkView"},qe=["src","onClick"],De=w(()=>l("span",null,"删除",-1)),Be=w(()=>l("span",null,"开始漫游",-1)),Ge=w(()=>l("svg",{t:"1729750931011",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6252",width:"14",height:"14"},[l("path",{d:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m3.008-92.992a416 416 0 1 0 0-832 416 416 0 0 0 0 832zM383.232 287.616l384 224.896-384 223.104v-448z",fill:"#2c2c2c","p-id":"6253"})],-1)),Fe=w(()=>l("span",null,"结束漫游",-1)),Xe=w(()=>l("svg",{t:"1729750966037",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7355",width:"14",height:"14"},[l("path",{d:"M512 1024A512 512 0 1 1 512 0a512 512 0 0 1 0 1024z m3.008-92.992a416 416 0 1 0 0-832 416 416 0 0 0 0 832zM320 320h384v384H320V320z",fill:"#262626","p-id":"7356"})],-1)),We=w(()=>l("span",null,"修改参数",-1)),Ze=w(()=>l("svg",{t:"1729819714307",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4267",width:"14",height:"14"},[l("path",{d:"M855.04 994.304H174.08c-78.848 0-143.36-64.512-143.36-143.36v-680.96c0-78.848 64.512-143.36 143.36-143.36h578.56c22.528 0 40.96 18.432 40.96 40.96s-18.432 40.96-40.96 40.96H174.08c-33.792 0-61.44 27.648-61.44 61.44v680.96c0 33.792 27.648 61.44 61.44 61.44h680.96c33.792 0 61.44-27.648 61.44-61.44v-450.56c0-22.528 18.432-40.96 40.96-40.96s40.96 18.432 40.96 40.96v450.56c0 78.848-64 143.36-143.36 143.36z",fill:"#2c2c2c","p-id":"4268"}),l("path",{d:"M378.368 757.76c-10.24 0-20.992-4.096-29.184-11.776-15.872-15.872-15.872-41.984 0-57.856L928.768 108.544c15.872-15.872 41.984-15.872 57.856 0 15.872 15.872 15.872 41.984 0 57.856L407.552 745.984c-8.192 7.68-18.432 11.776-29.184 11.776z",fill:"#2c2c2c","p-id":"4269"})],-1)),Ke=w(()=>l("h1",{style:{display:"flex","justify-content":"center"}},"是否保存编辑？？？",-1)),Qe=w(()=>l("div",{class:"title-vertical_line"},"飞行漫游属性",-1)),Ye=w(()=>l("div",{class:"title-vertical_line"},"坐标编辑",-1)),et={class:"poi-div"},tt={class:"position-title"},at=w(()=>l("h1",{style:{display:"flex","justify-content":"center"}},"是否保存坐标编辑？？？",-1)),nt=Le({__name:"index",setup(o){xe(ze);const i={interpolation:!1,speed:200,clockLoop:!0,surfaceHeight:!0,model:{url:"https://data.mars3d.cn/gltf/mars/qiche.gltf"},camera:{type:"gs",radius:500,followedX:500}};let s="",r=-1,n=N({}),b=N([]),O;const v=N(!1),p=N(!1),_=N(!1),I=N(!1);let $;const re=()=>{var e;return[{type:"input",field:"name",label:"路线名称",value:s,change(t){a.imgObject[r].name=t,we()}},{type:"number",field:"speed",label:"速度",step:1,min:1,max:200,value:n.value.speed,change(t){n.value.speed=t,M()}},{type:"switch",field:"interpolation",label:"是否弧形插值",value:n.value.interpolation,change(t){n.value.interpolation=t,M()}},{type:"switch",field:"clockLoop",label:"是否循环漫游",value:n.value.clockLoop,change(t){n.value.clockLoop=t,M()}},{type:"switch",field:"surfaceHeight",label:"是否贴地漫游",value:n.value.surfaceHeight,change(t){n.value.surfaceHeight=t,M()}},{type:"select",field:"model",label:"模型选择",value:((e=n.value.model)==null?void 0:e.url)||"https://data.mars3d.cn/gltf/mars/qiche.gltf",data:[{label:"无",value:"none"},{label:"汽车",value:"https://data.mars3d.cn/gltf/mars/qiche.gltf"},{label:"飞机",value:"https://data.mars3d.cn/gltf/mars/feiji.glb"},{label:"战斗机",value:"https://data.mars3d.cn/gltf/mars/zhanji.gltf"},{label:"行人",value:"https://data.mars3d.cn/gltf/mars/man/running.glb"}],change(t){Oe(t)}}]},me=(e,t)=>($=c.graphics[0].setCallbackPositions(),[{type:"number",field:"lng",label:"经度",step:1,min:0,max:360,value:e[0],change(L){const T=new d.LngLatPoint(L,e[1],e[2]).toCartesian(!1);$[t]=T,I.value=!0}},{type:"number",field:"lat",label:"纬度",step:1,min:0,max:180,value:e[1],change(L){const T=new d.LngLatPoint(e[0],L,e[2]).toCartesian(!1);$[t]=T,I.value=!0}},{type:"number",field:"alt",label:"高度",step:1,min:1,max:1e3,value:e[2],change(L){const T=new d.LngLatPoint(e[0],e[1],L).toCartesian(!1);$[t]=T,I.value=!0}}]);function F(e){}const a=ke({input:"",found:!1,imgObject:[{name:"没有飞行线路",img:"",center:"",graphics:{},isStart:!1,isPause:!1,roamOptions:{interpolation:!1,speed:200,clockLoop:!0,surfaceHeight:!0,model:{url:"none"}}}]});function z(e){a.imgObject.map(t=>{t.isStart=!1,t.isPause=!1}),e!==-1&&setTimeout(()=>{a.imgObject[e].isStart=f.isStart,a.imgObject[e].isPause=f.isPause},100)}Ce(()=>{ge(),c.on([d.EventType.editStop],function(e){v.value=!0}),c.on([d.EventType.editMovePoint,d.EventType.editAddPoint,d.EventType.editRemovePoint],function(e){b.value=e.graphic.toJSON().positions})});const ue=()=>{I.value&&(p.value=!0),_.value=!1},de=()=>{G(s,n.value),O=h.toJSON(),v.value=!1},X=()=>{c.clear(),c.addGraphic(O),b.value=O.positions,v.value=!1},pe=()=>{p.value=!1,I.value=!1,ce(c.graphics[0]),G(s,n.value),O=c.graphics[0].toJSON()},fe=()=>{p.value=!1,I.value=!1,X()};je(()=>{a.imgObject.map(e=>{e.isStart=!1,e.isPause=!1})});function ge(){try{const e=JSON.parse(localStorage.getItem("roamLists"));if(e&&e.length>0)for(let t=0;t<e.length;t++){const S=e[t];a.imgObject[0].img===""&&(a.imgObject.splice(0,1),a.found=!0),a.imgObject.push(S)}}catch(e){}}const he=()=>{const e=a.input,t=a.imgObject;if(!e){D("请输入名称");return}if(t[0].img===""&&(a.imgObject.splice(0,1),a.found=!0),a.imgObject.some(S=>S.name===e)){D(e+" 已存在，请更换名称!");return}D("请绘制飞行轨迹!"),c.clear(),ie().then(function(S){const L=JSON.parse(JSON.stringify(i));oe(e,L)}),a.input=""};P.on("addImgObject",e=>{a.imgObject.push(e.item),localStorage.setItem("roamLists",JSON.stringify(a.imgObject))}),P.on("editImgObject",e=>{a.imgObject[r]=e.item,localStorage.setItem("roamLists",JSON.stringify(a.imgObject))});const E=(e,t,S)=>{r=t,s=e.name,n.value=e.roamOptions,O=e.graphics,V(),z(-1),S&&le(e.center),c.clear(),c.addGraphic(e.graphics)},ve=(e,t)=>U(this,null,function*(){E(e,t,!1);try{Pe(),yield se(e.graphics.positions,e.roamOptions,e.name),$e(),z(t)}catch(S){}}),be=e=>{V(),z(e)},_e=e=>{if(a.imgObject.splice(e,1),c.clear(),a.imgObject.length===0){a.imgObject=[{name:"没有匹配的值",img:"",center:"",graphics:{},isStart:!1,isPause:!1,roamOptions:{interpolation:!1,speed:200,clockLoop:!0,surfaceHeight:!0,model:{url:"https://data.mars3d.cn/gltf/mars/qiche.gltf"},camera:{type:"gs",radius:50,followedX:50}}}],a.found=!1,localStorage.removeItem("roamLists");return}localStorage.setItem("roamLists",JSON.stringify(a.imgObject))},ye=(e,t)=>{E(t,e,!0),s=t.name,r=e,b.value=t.graphics.positions,n.value=a.imgObject[e].roamOptions,_.value=!0},M=()=>{localStorage.setItem("roamLists",JSON.stringify(a.imgObject))},we=()=>{localStorage.setItem("roamLists",JSON.stringify(a.imgObject))},Oe=e=>{e==="none"?delete n.value.model:n.value.model={url:e},M()};return(e,t)=>{const S=C("mars-input"),L=C("mars-button"),T=C("a-space-compact"),Se=C("mars-icon"),H=C("a-tooltip"),W=C("a-modal"),Z=C("mars-gui"),K=C("mars-dialog");return j(),J(K,{visible:!_.value,right:"10",top:"60",bottom:"40",width:"330",title:"飞行漫游"},{default:u(()=>[l("div",null,[l("div",Ee,[g(T,{style:{width:"100%"}},{default:u(()=>[g(S,{value:a.input,"onUpdate:value":t[0]||(t[0]=m=>a.input=m),placeholder:"输入名称"},null,8,["value"]),g(L,{onClick:he},{default:u(()=>[Te("新增路线")]),_:1})]),_:1})]),l("div",Ue,[(j(!0),A(Q,null,Y(a.imgObject,(m,k)=>(j(),A("div",{class:Ie(["bookmarkView-conponent",a.found?"addNewImg":"noFound"]),key:m.name},[ee(l("img",{class:"markImg",src:m.img,onClick:x=>E(m,k,!0)},null,8,qe),[[te,a.found]]),l("p",null,ae(m.name),1),g(H,{placement:"bottom"},{title:u(()=>[De]),default:u(()=>[ee(g(Se,{icon:"delete",class:"deleteImg",color:"var(--mars-text-color)",onClick:x=>_e(k)},null,8,["onClick"]),[[te,a.found]])]),_:2},1024),!m.isStart&&a.found?(j(),J(H,{key:0,placement:"bottom"},{title:u(()=>[Be]),default:u(()=>[g(R(B),{class:"flyImg",onClick:x=>ve(m,k)},{component:u(()=>[Ge]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0),m.isStart&&a.found?(j(),J(H,{key:1,placement:"bottom"},{title:u(()=>[Fe]),default:u(()=>[g(R(B),{class:"flyImg",onClick:x=>be(k)},{component:u(()=>[Xe]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0),a.found?(j(),J(H,{key:2,placement:"bottom"},{title:u(()=>[We]),default:u(()=>[g(R(B),{class:"editImg",onClick:x=>ye(k,m)},{component:u(()=>[Ze]),_:2},1032,["onClick"])]),_:2},1024)):q("",!0)],2))),128))]),g(W,{open:v.value,"onUpdate:open":t[1]||(t[1]=m=>v.value=m),title:"保存确认",onOk:de,onCancel:X},{default:u(()=>[Ke]),_:1},8,["open"])]),g(K,{visible:_.value,right:"10",top:"60",bottom:"40",width:"330",title:"属性编辑",onClosed:t[3]||(t[3]=m=>ue())},{default:u(()=>[l("div",null,[l("div",null,[Qe,g(Z,{options:re(),onChange:F,labelCol:9},null,8,["options"])]),l("div",null,[Ye,(j(!0),A(Q,null,Y(R(b),(m,k)=>(j(),A("div",et,[l("div",tt,"第"+ae(k+1)+"个点",1),g(Z,{options:me(m,k),onChange:F,labelCol:9},null,8,["options"])]))),256))])]),g(W,{open:p.value,"onUpdate:open":t[2]||(t[2]=m=>p.value=m),title:"保存确认",onOk:pe,onCancel:fe},{default:u(()=>[at]),_:1},8,["open"])]),_:1},8,["visible"])]),_:1},8,["visible"])}}}),rt=He(nt,[["__scopeId","data-v-3f992050"]]);export{rt as default};
