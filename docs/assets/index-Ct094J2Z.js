var ue=Object.defineProperty,de=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable;var A=(a,e,t)=>e in a?ue(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,F=(a,e)=>{for(var t in e||(e={}))fe.call(e,t)&&A(a,t,e[t]);if(j)for(var t of j(e))me.call(e,t)&&A(a,t,e[t]);return a},R=(a,e)=>de(a,pe(e));var y=(a,e,t)=>new Promise((r,o)=>{var u=f=>{try{C(t.next(f))}catch(g){o(g)}},p=f=>{try{C(t.throw(f))}catch(g){o(g)}},C=f=>f.done?r(f.value):Promise.resolve(f.value).then(u,p);C((t=t.apply(a,e)).next())});import{d as W,Z as c,_ as d,$ as l,a0 as h,G as x,ab as w,R as _e,f as b,a7 as k,a8 as V,a9 as U,k as z,F as D,aa as J,B as ye,u as he,H as ve}from"./vue-D4H2Ux2Y.js";import{u as ge}from"./use-lifecycle-CyVQVRUS.js";import{m as S,a as K,b as be,c as we,$ as Ce,e as Ne,_ as ke}from"./entry/index-BNp4bmLj-1732066199007.js";import{i as xe}from"./mars-util-cwUj8IQx.js";import"./antd-DgCI0x_J.js";const Se={class:"mars3d-popup-content-wrapper mars3d-popup-background"},$e={class:"mars3d-popup-content-wrapper mars3d-popup-background"},Le={class:"mars3d-template-titile"},qe=["href"],ze={class:"mars3d-template-content"},Te={key:0},Oe=l("label",null,"电话:",-1),Pe={key:1},Be=l("label",null,"地址:",-1),Ee={key:2},Ie=l("label",null,"类别:",-1),De={key:3},Ge=l("label",null,"经度:",-1),He={key:4},Me=l("label",null,"纬度:",-1),je=W({__name:"query-popup",props:{id:{},name:{},tel:{},address:{},type:{},yzb:{},xzb:{}},setup(a){const e=a,t=()=>{_.closePopup()};return(r,o)=>(c(),d("div",Se,[l("span",{class:"mars3d-popup-close-button mars3d-popup-color closeButton",onClick:t}," × "),l("div",$e,[l("div",Le,[l("a",{href:"https://www.amap.com/detail/"+e.id,target:"_black"},h(e.name),9,qe)]),l("div",ze,[e.tel?(c(),d("div",Te,[Oe,x(" "+h(e.tel),1)])):w("",!0),e.address?(c(),d("div",Pe,[Be,x(" "+h(e.address),1)])):w("",!0),e.type?(c(),d("div",Ee,[Ie,x(" "+h(e.type),1)])):w("",!0),e.xzb?(c(),d("div",De,[Ge,x(" "+h(e.xzb),1)])):w("",!0),e.xzb?(c(),d("div",He,[Me,x(" "+h(e.yzb),1)])):w("",!0)])])]))}}),N=S.Cesium;let v,_,P,$=null;const Y=[];function Ae(a){return y(this,null,function*(){for(let e=0;e<6;e++){const t=yield Ve(e+1);Y.push(t)}v=a,P=new S.query.GaodePOI({}),_=new S.layer.GraphicLayer({name:"POI查询",pid:99}),_.bindPopup(e=>{const t=e.graphic.attr||{};if(!t)return;const r=document.createElement("div");document.body.appendChild(r);const o=_e(je,{id:t.id,name:t.address,tel:t.tel?t.tel.toString():"",address:t.address,type:t.type?t.type.toString():"",yzb:t.yzb,xzb:t.xzb});return o.mount(r),o._container.innerHTML},{template:!1}),v.addLayer(_),v.on(S.EventType.cameraChanged,Z)})}function Z(){return y(this,null,function*(){$=yield P.getAddress({location:v.getCenter()})})}function Fe(){v&&(v.removeLayer(_),v.off(S.EventType.cameraChanged,Z),_.remove(),P=null,$=null,v=null)}function Re(a){return P.autoTip({text:a,city:$==null?void 0:$.city,location:v.getCenter()})}function H(a,e){return y(this,null,function*(){var t;if(xe(a)){const o=a.split(",");if(o.length!==2)return;const u=Number(o[0]),p=Number(o[1]);if(isNaN(u)||isNaN(p))return;t={query:`xzb:${u}
yzb:${p}`,count:6,page:e-1}}else t={query:"address:"+a,count:6,page:e-1};let r;return t&&typeof t=="object"&&(r=yield K.get({url:"/address",params:t})),r})}function Q(a){O(),a.forEach((e,t)=>y(this,null,function*(){const r=Number(e.xzb),o=Number(e.yzb);if(isNaN(r)||isNaN(o))return;e.lng=r,e.lat=o;const u=new S.graphic.BillboardEntity({position:N.Cartesian3.fromDegrees(r,o),style:{pixelSize:10,color:"#ffffff",outline:!0,outlineColor:"#ffffff",outlineWidth:2,scaleByDistance:new N.NearFarScalar(1e3,1,1e6,.1),clampToGround:!0,visibleDepth:!1,label:{text:e.address,font_size:20,color:"#ffffff",outline:!0,outlineWidth:2,outlineColor:N.Color.BLACK,horizontalOrigin:N.HorizontalOrigin.CENTER,verticalOrigin:N.VerticalOrigin.BOTTOM,pixelOffsetY:-10,distanceDisplayCondition:new N.DistanceDisplayCondition(0,2e5),clampToGround:!0,visibleDepth:!1},image:Y[t]},attr:e});_.addGraphic(u),e._graphic=u})),a.length>1&&_.flyTo({radius:5e3,pitch:-90})}let G;function Ve(a){return y(this,null,function*(){G||(G=yield N.Resource.fetchImage({url:"img/poi/indexMark.png"}));const e=document.createElement("canvas");e.width=19,e.height=25;const t=e.getContext("2d");return t.clearRect(0,0,e.width,e.height),t.drawImage(G,0,0),t.fillStyle="#ffffff",t.font="22px 楷体",t.textBaseline="middle",t.fillText(a,4,10),e.toDataURL("image/png")})}function Ue(a,e){return y(this,null,function*(){const t=a.split(",");if(t.length!==2)return;const r=Number(t[0]),o=Number(t[1]);if(isNaN(r)||isNaN(o))return;var u={query:"address:"+a,count:6,page:e-1};let p;return u&&typeof u=="object"&&(p=yield K.get({url:"/address",params:u})),p})}function X(a,e){v.flyToGraphic(a,R(F({},e),{complete:()=>_.openPopup(a)}))}function O(){_.closePopup(),_.clear()}const Je=Object.freeze(Object.defineProperty({__proto__:null,centerAtLonLat:Ue,clearLayers:O,flyToGraphic:X,get graphicLayer(){return _},onMounted:Ae,onUnmounted:Fe,queryData:Re,querySiteList:H,showPOIArr:Q},Symbol.toStringTag,{value:"Module"})),We={class:"query-poi__search"},Ke={key:0,class:"search-list"},Ye=["onClick"],Ze={key:1,class:"query-site"},Qe=["onClick"],Xe={class:"query-site__context"},et=["title"],tt={class:"query-site-text_num"},at={class:"query-site__page"},st={class:"query-site-allcount"},T="mars3d_queryGaodePOI",ot=W({__name:"index",setup(a){ge(Je);const e=b(!1),t=b(""),r=b([]),o=b(!1),u=b(!0),p=b([]),C=b(0);let f=b(1),g;const ee=()=>{g=setTimeout(()=>{o.value=!1,clearTimeout(g),g=null},500)},te=n=>y(this,null,function*(){if(n===""){B(),O();return}const s=yield H(n,1);e.value=!1,u.value=!1;const m=[];s&&(s.list.forEach(L=>{m.every(I=>I.value!==L.address)&&m.push({value:L.address})}),r.value=m,o.value=!0)}),B=()=>{if(t.value)return;const n=JSON.parse(localStorage.getItem(T));n&&(r.value=(n||[]).map(s=>({value:s})),o.value=!0,u.value=!0),g&&clearTimeout(g),e.value=!1},ae=()=>{localStorage.removeItem(T),r.value=[],o.value=!1},E=n=>y(this,null,function*(){if(n===""){B(),O();return}f.value=1,t.value=n,be(),ne(n),yield M(n,1),we(),e.value=!0,o.value=!1});function se(n){var s;((s=n.target.dataset)==null?void 0:s.event)!=="prevent"&&n.target.tagName!=="INPUT"&&n.preventDefault()}function M(n,s){return y(this,null,function*(){const m=yield H(n,s);if(!m||!m.list||m.list.length<=0){Ce("暂无数据"),p.value=[];return}return p.value=m.list||[],C.value=Number(m.allcount)||0,Q(m.list||[]),m})}function oe(n){const s=n._graphic;if(s===null)return Ne(n.name+" 无经纬度坐标信息！");X(s,{radius:2e3})}function ne(n){try{const s=JSON.parse(localStorage.getItem(T))||[];s.includes(n)||s.unshift(n),localStorage.setItem(T,JSON.stringify(s.slice(0,10)))}catch(s){throw new Error(s)}}return(n,s)=>{const m=k("mars-input"),L=k("mars-icon"),I=k("mars-button"),re=k("a-pagination"),le=k("a-empty"),ie=k("mars-dialog");return c(),V(ie,{draggable:!1,customClass:"query-poi-pannel",top:"10",left:"10"},{default:U(()=>[l("div",{class:"query-poi",onMousedown:se},[l("div",We,[z(m,{placeholder:"搜索 地点",value:t.value,"onUpdate:value":s[0]||(s[0]=i=>t.value=i),class:"input","data-event":"prevent",onBlur:ee,onFocus:B,allowClear:"",onInput:s[1]||(s[1]=i=>te(t.value)),onPressEnter:s[2]||(s[2]=i=>E(t.value))},null,8,["value"]),z(I,{class:"button"},{default:U(()=>[z(L,{icon:"search",width:"20",color:"#fff",onClick:s[3]||(s[3]=i=>E(t.value))})]),_:1})]),o.value?(c(),d("ul",Ke,[(c(!0),d(D,null,J(r.value,(i,q)=>(c(),d("li",{key:q,class:"search-list__item",onClick:ce=>E(i.value)},h(i.value),9,Ye))),128)),u.value?(c(),d("p",{key:0,class:"search-list__clear",onClick:ae},"删除历史")):w("",!0)])):w("",!0),e.value?(c(),d("div",Ze,[p.value&&p.value.length?(c(),d(D,{key:0},[l("ul",null,[(c(!0),d(D,null,J(p.value,(i,q)=>(c(),d("li",{key:q,class:"query-site__item",onClick:ye(ce=>oe(i),["stop"])},[l("div",Xe,[l("p",{class:"query-site-text f-toe",title:i.address},[l("span",tt,h(q+1),1),x(" "+h(i.address),1)],8,et)])],8,Qe))),128))]),l("div",at,[l("p",st,"共"+h(C.value)+"条结果",1),z(re,{onChange:s[4]||(s[4]=i=>M(t.value,i)),size:"small",total:C.value,pageSize:"6",simple:!0,current:he(f),"onUpdate:current":s[5]||(s[5]=i=>ve(f)?f.value=i:f=i)},null,8,["total","current"])])],64)):(c(),V(le,{key:1,class:"f-push-10-t"}))])):w("",!0)],32)]),_:1})}}}),dt=ke(ot,[["__scopeId","data-v-2083d329"]]);export{dt as default};
