/**
 * Mars3D平台插件,支持气象 风向图 功能插件  mars3d-wind
 *
 * 版本信息：v3.7.22
 * 编译日期：2024-07-15 11:22:34
 * 版权所有：Copyright by 火星科技  http://mars3d.cn
 * 使用单位：泉州中科星桥空天技术有限公司 ，2024-07-15
 */
(function (global, factory) {
  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, (window.mars3d || require('mars3d'))) :
  typeof define === 'function' && define.amd ? define(['exports', 'mars3d'], factory) :
  (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory(global["mars3d-wind"] = {}, global.mars3d));
})(this, (function (exports, mars3d) { 
'use strict';const _0x11ff57=_0x1ef3;(function(_0x236a40,_0xac10c2){const _0x3032c3=_0x1ef3,_0x496092=_0x236a40();while(!![]){try{const _0x56f169=-parseInt(_0x3032c3(0x194))/0x1+parseInt(_0x3032c3(0x1c8))/0x2+-parseInt(_0x3032c3(0x20f))/0x3+-parseInt(_0x3032c3(0x1a6))/0x4*(parseInt(_0x3032c3(0x1a1))/0x5)+-parseInt(_0x3032c3(0x1e3))/0x6+-parseInt(_0x3032c3(0x222))/0x7+parseInt(_0x3032c3(0x1d5))/0x8;if(_0x56f169===_0xac10c2)break;else _0x496092['push'](_0x496092['shift']());}catch(_0x38f9e0){_0x496092['push'](_0x496092['shift']());}}}(_0x5107,0x242ec));function _interopNamespace(_0x24e5db){const _0x71ae85=_0x1ef3;if(_0x24e5db&&_0x24e5db['__esModule'])return _0x24e5db;var _0x3e0086=Object['create'](null);return _0x24e5db&&Object['keys'](_0x24e5db)[_0x71ae85(0x1b8)](function(_0xe6e256){if(_0xe6e256!=='default'){var _0x49e7f8=Object['getOwnPropertyDescriptor'](_0x24e5db,_0xe6e256);Object['defineProperty'](_0x3e0086,_0xe6e256,_0x49e7f8['get']?_0x49e7f8:{'enumerable':!![],'get':function(){return _0x24e5db[_0xe6e256];}});}}),_0x3e0086[_0x71ae85(0x175)]=_0x24e5db,_0x3e0086;}function _0x1ef3(_0x5ac290,_0x13d653){const _0x51078a=_0x5107();return _0x1ef3=function(_0x1ef3ce,_0x4df1bf){_0x1ef3ce=_0x1ef3ce-0x16f;let _0x2eab39=_0x51078a[_0x1ef3ce];return _0x2eab39;},_0x1ef3(_0x5ac290,_0x13d653);}var mars3d__namespace=_interopNamespace(mars3d);const Cesium$7=mars3d__namespace['Cesium'];function getU(_0x190224,_0x15f573){const _0x1e2e6a=_0x1ef3,_0x18ac99=_0x190224*Math['cos'](Cesium$7['Math'][_0x1e2e6a(0x1fd)](_0x15f573));return _0x18ac99;}function getV(_0x2191c8,_0xc0b33a){const _0x4de1fb=_0x1ef3,_0x2903ed=_0x2191c8*Math['sin'](Cesium$7['Math'][_0x4de1fb(0x1fd)](_0xc0b33a));return _0x2903ed;}function getSpeed(_0x1f4fc7,_0x35c131){const _0x4de9d3=Math['sqrt'](Math['pow'](_0x1f4fc7,0x2)+Math['pow'](_0x35c131,0x2));return _0x4de9d3;}function getDirection(_0x4179cc,_0x3cd4ce){const _0x480407=_0x1ef3;let _0x40e859=Cesium$7[_0x480407(0x253)][_0x480407(0x198)](Math['atan2'](_0x3cd4ce,_0x4179cc));return _0x40e859+=_0x40e859<0x0?0x168:0x0,_0x40e859;}var WindUtil={'__proto__':null,'getU':getU,'getV':getV,'getSpeed':getSpeed,'getDirection':getDirection};const Cesium$6=mars3d__namespace['Cesium'];class CustomPrimitive{constructor(_0x1808db){const _0x57c7b8=_0x1ef3;this['commandType']=_0x1808db[_0x57c7b8(0x22f)],this['geometry']=_0x1808db['geometry'],this['attributeLocations']=_0x1808db['attributeLocations'],this['primitiveType']=_0x1808db[_0x57c7b8(0x1a2)],this[_0x57c7b8(0x181)]=_0x1808db[_0x57c7b8(0x181)],this[_0x57c7b8(0x1c5)]=_0x1808db[_0x57c7b8(0x1c5)],this['fragmentShaderSource']=_0x1808db[_0x57c7b8(0x1cc)],this['rawRenderState']=_0x1808db['rawRenderState'],this['framebuffer']=_0x1808db['framebuffer'],this['outputTexture']=_0x1808db[_0x57c7b8(0x227)],this['autoClear']=_0x1808db['autoClear']??![],this['preExecute']=_0x1808db['preExecute'],this['show']=!![],this[_0x57c7b8(0x23c)]=undefined,this[_0x57c7b8(0x217)]=undefined,this['autoClear']&&(this['clearCommand']=new Cesium$6['ClearCommand']({'color':new Cesium$6[(_0x57c7b8(0x1f1))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x57c7b8(0x1cb)]}));}[_0x11ff57(0x254)](_0x175199){const _0x51c486=_0x11ff57;switch(this['commandType']){case _0x51c486(0x24d):{const _0x2b4a57=Cesium$6[_0x51c486(0x1d6)][_0x51c486(0x1da)]({'context':_0x175199,'geometry':this['geometry'],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6['BufferUsage']['STATIC_DRAW']}),_0x2c97d5=Cesium$6['ShaderProgram']['fromCache']({'context':_0x175199,'attributeLocations':this[_0x51c486(0x1f7)],'vertexShaderSource':this[_0x51c486(0x1c5)],'fragmentShaderSource':this['fragmentShaderSource']}),_0x574300=Cesium$6['RenderState']['fromCache'](this[_0x51c486(0x179)]);return new Cesium$6[(_0x51c486(0x18d))]({'primitiveType':this['primitiveType'],'shaderProgram':_0x2c97d5,'vertexArray':_0x2b4a57,'modelMatrix':Cesium$6['Matrix4']['IDENTITY'],'renderState':_0x574300,'uniformMap':this['uniformMap'],'castShadows':![],'receiveShadows':![],'framebuffer':this['framebuffer'],'pass':Cesium$6['Pass'][_0x51c486(0x1cb)],'pickOnly':!![],'owner':this});}case'Compute':{return new Cesium$6[(_0x51c486(0x1fa))]({'owner':this,'fragmentShaderSource':this['fragmentShaderSource'],'uniformMap':this['uniformMap'],'outputTexture':this['outputTexture'],'persists':!![]});}}}['setGeometry'](_0x42d9fe,_0xe9b558){const _0x397d93=_0x11ff57;this['geometry']=_0xe9b558;const _0x425dfb=Cesium$6['VertexArray']['fromGeometry']({'context':_0x42d9fe,'geometry':this[_0x397d93(0x17f)],'attributeLocations':this['attributeLocations'],'bufferUsage':Cesium$6[_0x397d93(0x1dc)][_0x397d93(0x1d2)]});this[_0x397d93(0x23c)][_0x397d93(0x1b3)]=_0x425dfb;}['update'](_0xdc3760){const _0x12e5de=_0x11ff57;if(!this[_0x12e5de(0x180)])return;if(_0xdc3760['mode']!==Cesium$6['SceneMode']['SCENE3D'])return;!Cesium$6['defined'](this[_0x12e5de(0x23c)])&&(this['commandToExecute']=this[_0x12e5de(0x254)](_0xdc3760[_0x12e5de(0x1b9)])),Cesium$6[_0x12e5de(0x1e7)](this['preExecute'])&&this['preExecute'](),Cesium$6['defined'](this['clearCommand'])&&_0xdc3760['commandList']['push'](this[_0x12e5de(0x217)]),_0xdc3760[_0x12e5de(0x177)]['push'](this['commandToExecute']);}['isDestroyed'](){return![];}['destroy'](){const _0x1fa29d=_0x11ff57;if(this['clearCommand']){var _0x5e7e78,_0x504b0b;(_0x5e7e78=this['clearCommand'])!==null&&_0x5e7e78!==void 0x0&&_0x5e7e78['vertexArray']&&this['clearCommand']['vertexArray'][_0x1fa29d(0x19f)](),(_0x504b0b=this['clearCommand'])!==null&&_0x504b0b!==void 0x0&&_0x504b0b['shaderProgram']&&this['clearCommand']['shaderProgram'][_0x1fa29d(0x19f)](),delete this[_0x1fa29d(0x217)];}return this['commandToExecute']&&(this['commandToExecute']['vertexArray']&&this['commandToExecute']['vertexArray'][_0x1fa29d(0x19f)](),this['commandToExecute']['shaderProgram']&&this[_0x1fa29d(0x23c)]['shaderProgram']['destroy'](),delete this['commandToExecute']),Cesium$6['destroyObject'](this);}}const Cesium$5=mars3d__namespace['Cesium'],Util=(function(){const _0xe299ac=function(){const _0x58d8a1=_0x1ef3,_0x10fcb3=new Cesium$5['Geometry']({'attributes':new Cesium$5['GeometryAttributes']({'position':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x58d8a1(0x187)][_0x58d8a1(0x1d9)],'componentsPerAttribute':0x3,'values':new Float32Array([-0x1,-0x1,0x0,0x1,-0x1,0x0,0x1,0x1,0x0,-0x1,0x1,0x0])}),'st':new Cesium$5['GeometryAttribute']({'componentDatatype':Cesium$5[_0x58d8a1(0x187)]['FLOAT'],'componentsPerAttribute':0x2,'values':new Float32Array([0x0,0x0,0x1,0x0,0x1,0x1,0x0,0x1])})}),'indices':new Uint32Array([0x3,0x2,0x0,0x0,0x2,0x1])});return _0x10fcb3;},_0x5a2876=function(_0x1cff1a,_0x47fb47){const _0x71c96d=_0x1ef3;if(Cesium$5['defined'](_0x47fb47)){const _0x54c682={};_0x54c682['arrayBufferView']=_0x47fb47,_0x1cff1a[_0x71c96d(0x1ea)]=_0x54c682;}const _0x2922c2=new Cesium$5[(_0x71c96d(0x1ab))](_0x1cff1a);return _0x2922c2;},_0x1a723b=function(_0x2ce3a7,_0x5ac81d,_0xa56b0e){const _0xcc90de=new Cesium$5['Framebuffer']({'context':_0x2ce3a7,'colorTextures':[_0x5ac81d],'depthTexture':_0xa56b0e});return _0xcc90de;},_0x2e98c7=function(_0x1916e3){const _0x48fefa=_0x1ef3,_0x347bd3=!![],_0x41f81f=![],_0x5f3f49={'viewport':_0x1916e3['viewport'],'depthTest':_0x1916e3['depthTest'],'depthMask':_0x1916e3[_0x48fefa(0x18a)],'blending':_0x1916e3[_0x48fefa(0x1a9)]},_0x366ec5=Cesium$5['Appearance'][_0x48fefa(0x213)](_0x347bd3,_0x41f81f,_0x5f3f49);return _0x366ec5;},_0x243aad=function(_0x4b4b91){const _0x2af38e=_0x1ef3,_0x5ae93c={},_0xcd22f0=Cesium$5[_0x2af38e(0x253)]['mod'](_0x4b4b91[_0x2af38e(0x247)],Cesium$5['Math']['TWO_PI']),_0x59f7e7=Cesium$5[_0x2af38e(0x253)]['mod'](_0x4b4b91['east'],Cesium$5['Math']['TWO_PI']),_0x317051=_0x4b4b91[_0x2af38e(0x1bd)];let _0x40b0ef,_0x205dee;_0x317051>Cesium$5['Math']['THREE_PI_OVER_TWO']?(_0x40b0ef=0x0,_0x205dee=Cesium$5[_0x2af38e(0x253)]['TWO_PI']):_0x59f7e7-_0xcd22f0<_0x317051?(_0x40b0ef=_0xcd22f0,_0x205dee=_0xcd22f0+_0x317051):(_0x40b0ef=_0xcd22f0,_0x205dee=_0x59f7e7);_0x5ae93c['lon']={'min':Cesium$5['Math'][_0x2af38e(0x198)](_0x40b0ef),'max':Cesium$5['Math'][_0x2af38e(0x198)](_0x205dee)};const _0x5a6edd=_0x4b4b91[_0x2af38e(0x178)],_0x1f898e=_0x4b4b91['north'],_0x5512c5=_0x4b4b91['height'],_0x562105=_0x5512c5>Cesium$5[_0x2af38e(0x253)]['PI']/0xc?_0x5512c5/0x2:0x0;let _0x43e8fb=Cesium$5['Math']['clampToLatitudeRange'](_0x5a6edd-_0x562105),_0x3c9ba1=Cesium$5[_0x2af38e(0x253)][_0x2af38e(0x1d0)](_0x1f898e+_0x562105);return _0x43e8fb<-Cesium$5[_0x2af38e(0x253)]['PI_OVER_THREE']&&(_0x43e8fb=-Cesium$5['Math'][_0x2af38e(0x1d1)]),_0x3c9ba1>Cesium$5['Math']['PI_OVER_THREE']&&(_0x3c9ba1=Cesium$5[_0x2af38e(0x253)]['PI_OVER_TWO']),_0x5ae93c['lat']={'min':Cesium$5[_0x2af38e(0x253)][_0x2af38e(0x198)](_0x43e8fb),'max':Cesium$5[_0x2af38e(0x253)]['toDegrees'](_0x3c9ba1)},_0x5ae93c;};return{'getFullscreenQuad':_0xe299ac,'createTexture':_0x5a2876,'createFramebuffer':_0x1a723b,'createRawRenderState':_0x2e98c7,'viewRectangleToLonLatRange':_0x243aad};}());var segmentDraw_vert=_0x11ff57(0x186),segmentDraw_frag=_0x11ff57(0x1e2),fullscreen_vert='in\x20vec3\x20position;\x0ain\x20vec2\x20st;\x0a\x0aout\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20textureCoordinate\x20=\x20st;\x0a\x20\x20\x20\x20gl_Position\x20=\x20vec4(position,\x201.0);\x0a}\x0a',trailDraw_frag='uniform\x20sampler2D\x20segmentsColorTexture;\x0auniform\x20sampler2D\x20segmentsDepthTexture;\x0a\x0auniform\x20sampler2D\x20currentTrailsColor;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0auniform\x20float\x20fadeOpacity;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20pointsColor\x20=\x20texture(segmentsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(currentTrailsColor,\x20textureCoordinate);\x0a\x0a\x20\x20\x20\x20trailsColor\x20=\x20floor(fadeOpacity\x20*\x20255.0\x20*\x20trailsColor)\x20/\x20255.0;\x20//\x20make\x20sure\x20the\x20trailsColor\x20will\x20be\x20strictly\x20decreased\x0a\x0a\x20\x20\x20\x20float\x20pointsDepth\x20=\x20texture(segmentsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(pointsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20pointsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20out_FragColor\x20+\x20trailsColor;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20gl_FragDepth\x20=\x20min(pointsDepth,\x20trailsDepth);\x0a}\x0a',screenDraw_frag='uniform\x20sampler2D\x20trailsColorTexture;\x0auniform\x20sampler2D\x20trailsDepthTexture;\x0a\x0ain\x20vec2\x20textureCoordinate;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20trailsColor\x20=\x20texture(trailsColorTexture,\x20textureCoordinate);\x0a\x20\x20\x20\x20float\x20trailsDepth\x20=\x20texture(trailsDepthTexture,\x20textureCoordinate).r;\x0a\x20\x20\x20\x20float\x20globeDepth\x20=\x20czm_unpackDepth(texture(czm_globeDepthTexture,\x20textureCoordinate));\x0a\x0a\x20\x20\x20\x20if\x20(trailsDepth\x20<\x20globeDepth)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20trailsColor;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$4=mars3d__namespace[_0x11ff57(0x1e9)];class ParticlesRendering{constructor(_0x4d3f97,_0x36c7a0,_0x27e4c2,_0x4fea30,_0x43f631){this['createRenderingTextures'](_0x4d3f97,_0x36c7a0,_0x27e4c2['colors']),this['createRenderingFramebuffers'](_0x4d3f97),this['createRenderingPrimitives'](_0x4d3f97,_0x27e4c2,_0x4fea30,_0x43f631);}['createRenderingTextures'](_0x5a27ec,_0x1930ea,_0x39c17c){const _0x5519a8=_0x11ff57,_0x45c534={'context':_0x5a27ec,'width':_0x5a27ec['drawingBufferWidth'],'height':_0x5a27ec['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['RGBA'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_BYTE']},_0x31e881={'context':_0x5a27ec,'width':_0x5a27ec['drawingBufferWidth'],'height':_0x5a27ec['drawingBufferHeight'],'pixelFormat':Cesium$4['PixelFormat']['DEPTH_COMPONENT'],'pixelDatatype':Cesium$4['PixelDatatype']['UNSIGNED_INT']},_0x5c0dfc=_0x39c17c['length'],_0x1fc04f=new Float32Array(_0x5c0dfc*0x3);for(let _0x3ae579=0x0;_0x3ae579<_0x5c0dfc;_0x3ae579++){const _0x43e47c=Cesium$4['Color']['fromCssColorString'](_0x39c17c[_0x3ae579]);_0x1fc04f[0x3*_0x3ae579]=_0x43e47c['red'],_0x1fc04f[0x3*_0x3ae579+0x1]=_0x43e47c[_0x5519a8(0x1db)],_0x1fc04f[0x3*_0x3ae579+0x2]=_0x43e47c['blue'];}const _0x6cfd93={'context':_0x5a27ec,'width':_0x5c0dfc,'height':0x1,'pixelFormat':Cesium$4['PixelFormat'][_0x5519a8(0x1e0)],'pixelDatatype':Cesium$4['PixelDatatype']['FLOAT'],'sampler':new Cesium$4['Sampler']({'minificationFilter':Cesium$4['TextureMinificationFilter']['LINEAR'],'magnificationFilter':Cesium$4[_0x5519a8(0x24f)]['LINEAR']})};this[_0x5519a8(0x1a7)]={'segmentsColor':Util['createTexture'](_0x45c534),'segmentsDepth':Util['createTexture'](_0x31e881),'currentTrailsColor':Util['createTexture'](_0x45c534),'currentTrailsDepth':Util['createTexture'](_0x31e881),'nextTrailsColor':Util[_0x5519a8(0x1ef)](_0x45c534),'nextTrailsDepth':Util[_0x5519a8(0x1ef)](_0x31e881),'colorTable':Util[_0x5519a8(0x1ef)](_0x6cfd93,_0x1fc04f)};}['createRenderingFramebuffers'](_0x5c67d3){const _0x3e880f=_0x11ff57;this['framebuffers']={'segments':Util[_0x3e880f(0x1b1)](_0x5c67d3,this['textures']['segmentsColor'],this[_0x3e880f(0x1a7)]['segmentsDepth']),'currentTrails':Util[_0x3e880f(0x1b1)](_0x5c67d3,this[_0x3e880f(0x1a7)]['currentTrailsColor'],this['textures'][_0x3e880f(0x19a)]),'nextTrails':Util['createFramebuffer'](_0x5c67d3,this['textures']['nextTrailsColor'],this[_0x3e880f(0x1a7)]['nextTrailsDepth'])};}['createSegmentsGeometry'](_0x5e6fa3){const _0x5683be=_0x11ff57,_0x533d55=0x4;let _0x428f99=[];for(let _0x2dd280=0x0;_0x2dd280<_0x5e6fa3['particlesTextureSize'];_0x2dd280++){for(let _0x118427=0x0;_0x118427<_0x5e6fa3[_0x5683be(0x255)];_0x118427++){for(let _0x2c3894=0x0;_0x2c3894<_0x533d55;_0x2c3894++){_0x428f99[_0x5683be(0x22a)](_0x2dd280/_0x5e6fa3[_0x5683be(0x255)]),_0x428f99['push'](_0x118427/_0x5e6fa3['particlesTextureSize']);}}}_0x428f99=new Float32Array(_0x428f99);let _0x4a6164=[];const _0x5264a0=[-0x1,0x1],_0x5d1355=[-0x1,0x1];for(let _0x44c881=0x0;_0x44c881<_0x5e6fa3['maxParticles'];_0x44c881++){for(let _0x29153b=0x0;_0x29153b<_0x533d55/0x2;_0x29153b++){for(let _0x217731=0x0;_0x217731<_0x533d55/0x2;_0x217731++){_0x4a6164['push'](_0x5264a0[_0x29153b]),_0x4a6164['push'](_0x5d1355[_0x217731]),_0x4a6164['push'](0x0);}}}_0x4a6164=new Float32Array(_0x4a6164);const _0x278358=0x6*_0x5e6fa3['maxParticles'],_0x520320=new Uint32Array(_0x278358);for(let _0x409e4f=0x0,_0x29b61f=0x0,_0x3c357c=0x0;_0x409e4f<_0x5e6fa3['maxParticles'];_0x409e4f++){_0x520320[_0x29b61f++]=_0x3c357c+0x0,_0x520320[_0x29b61f++]=_0x3c357c+0x1,_0x520320[_0x29b61f++]=_0x3c357c+0x2,_0x520320[_0x29b61f++]=_0x3c357c+0x2,_0x520320[_0x29b61f++]=_0x3c357c+0x1,_0x520320[_0x29b61f++]=_0x3c357c+0x3,_0x3c357c+=0x4;}const _0x2b7a38=new Cesium$4[(_0x5683be(0x219))]({'attributes':new Cesium$4[(_0x5683be(0x20e))]({'st':new Cesium$4['GeometryAttribute']({'componentDatatype':Cesium$4['ComponentDatatype']['FLOAT'],'componentsPerAttribute':0x2,'values':_0x428f99}),'normal':new Cesium$4[(_0x5683be(0x24e))]({'componentDatatype':Cesium$4[_0x5683be(0x187)]['FLOAT'],'componentsPerAttribute':0x3,'values':_0x4a6164})}),'indices':_0x520320});return _0x2b7a38;}['createRenderingPrimitives'](_0x5f08da,_0x2b37a0,_0x479e6e,_0x24a08c){const _0x52b23f=_0x11ff57,_0x40a112=this;this['primitives']={'segments':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'st':0x0,'normal':0x1},'geometry':this[_0x52b23f(0x208)](_0x2b37a0),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'currentParticlesPosition':function(){return _0x24a08c['particlesTextures']['currentParticlesPosition'];},'postProcessingPosition':function(){return _0x24a08c['particlesTextures']['postProcessingPosition'];},'postProcessingSpeed':function(){const _0x210808=_0x52b23f;return _0x24a08c['particlesTextures'][_0x210808(0x257)];},'colorTable':function(){return _0x40a112['textures']['colorTable'];},'aspect':function(){const _0x1157ae=_0x52b23f;return _0x5f08da[_0x1157ae(0x242)]/_0x5f08da[_0x1157ae(0x212)];},'pixelSize':function(){const _0x4e052a=_0x52b23f;return _0x479e6e[_0x4e052a(0x1af)];},'lineWidth':function(){return _0x2b37a0['lineWidth'];},'particleHeight':function(){return _0x2b37a0['particleHeight'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_vert]}),'fragmentShaderSource':new Cesium$4['ShaderSource']({'sources':[segmentDraw_frag]}),'rawRenderState':Util['createRawRenderState']({'viewport':undefined,'depthTest':{'enabled':!![]},'depthMask':!![]}),'framebuffer':this[_0x52b23f(0x241)]['segments'],'autoClear':!![]}),'trails':new CustomPrimitive({'commandType':_0x52b23f(0x24d),'attributeLocations':{'position':0x0,'st':0x1},'geometry':Util['getFullscreenQuad'](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'segmentsColorTexture':function(){return _0x40a112['textures']['segmentsColor'];},'segmentsDepthTexture':function(){const _0x57cf64=_0x52b23f;return _0x40a112[_0x57cf64(0x1a7)]['segmentsDepth'];},'currentTrailsColor':function(){const _0x59d3a6=_0x52b23f;return _0x40a112[_0x59d3a6(0x241)]['currentTrails']['getColorTexture'](0x0);},'trailsDepthTexture':function(){return _0x40a112['framebuffers']['currentTrails']['depthTexture'];},'fadeOpacity':function(){return _0x2b37a0['fadeOpacity'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x52b23f(0x173))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[trailDraw_frag]}),'rawRenderState':Util[_0x52b23f(0x1ec)]({'viewport':undefined,'depthTest':{'enabled':!![],'func':Cesium$4['DepthFunction'][_0x52b23f(0x1c9)]},'depthMask':!![]}),'framebuffer':this[_0x52b23f(0x241)]['nextTrails'],'autoClear':!![],'preExecute':function(){const _0x592291=_0x52b23f,_0x55a877=_0x40a112['framebuffers']['currentTrails'];_0x40a112[_0x592291(0x241)]['currentTrails']=_0x40a112['framebuffers']['nextTrails'],_0x40a112['framebuffers'][_0x592291(0x240)]=_0x55a877,_0x40a112['primitives']['trails']['commandToExecute'][_0x592291(0x1aa)]=_0x40a112['framebuffers'][_0x592291(0x240)],_0x40a112['primitives']['trails']['clearCommand']['framebuffer']=_0x40a112['framebuffers']['nextTrails'];}}),'screen':new CustomPrimitive({'commandType':'Draw','attributeLocations':{'position':0x0,'st':0x1},'geometry':Util[_0x52b23f(0x1ee)](),'primitiveType':Cesium$4['PrimitiveType']['TRIANGLES'],'uniformMap':{'trailsColorTexture':function(){const _0x535357=_0x52b23f;return _0x40a112['framebuffers'][_0x535357(0x240)]['getColorTexture'](0x0);},'trailsDepthTexture':function(){const _0x313463=_0x52b23f;return _0x40a112['framebuffers'][_0x313463(0x240)]['depthTexture'];}},'vertexShaderSource':new Cesium$4['ShaderSource']({'defines':['DISABLE_GL_POSITION_LOG_DEPTH'],'sources':[fullscreen_vert]}),'fragmentShaderSource':new Cesium$4[(_0x52b23f(0x173))]({'defines':['DISABLE_LOG_DEPTH_FRAGMENT_WRITE'],'sources':[screenDraw_frag]}),'rawRenderState':Util[_0x52b23f(0x1ec)]({'viewport':undefined,'depthTest':{'enabled':![]},'depthMask':!![],'blending':{'enabled':!![]}}),'framebuffer':undefined})};}}var getWind_frag=_0x11ff57(0x24a),updateSpeed_frag='uniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0auniform\x20sampler2D\x20particlesWind;\x0a\x0a//\x20used\x20to\x20calculate\x20the\x20wind\x20norm\x0auniform\x20vec2\x20uSpeedRange;\x20//\x20(min,\x20max);\x0auniform\x20vec2\x20vSpeedRange;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20speedFactor;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0afloat\x20calculateWindNorm(vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec3\x20percent\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20percent.x\x20=\x20(speed.x\x20-\x20uSpeedRange.x)\x20/\x20(uSpeedRange.y\x20-\x20uSpeedRange.x);\x0a\x20\x20\x20\x20percent.y\x20=\x20(speed.y\x20-\x20vSpeedRange.x)\x20/\x20(vSpeedRange.y\x20-\x20vSpeedRange.x);\x0a\x20\x20\x20\x20float\x20normalization\x20=\x20length(percent);\x0a\x0a\x20\x20\x20\x20return\x20normalization;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20//\x20vec3\x20currentSpeed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20texture(particlesWind,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20vec4(speedFactor\x20*\x20pixelSize\x20*\x20windVector,\x20calculateWindNorm(windVector));\x0a\x20\x20\x20\x20out_FragColor\x20=\x20nextSpeed;\x0a}\x0a',updatePosition_frag='uniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20sampler2D\x20currentParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20lengthOfLonLat(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20unit\x20conversion:\x20meters\x20->\x20longitude\x20latitude\x20degrees\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_system#Length_of_a_degree\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20Calculate\x20the\x20length\x20of\x20a\x20degree\x20of\x20latitude\x20and\x20longitude\x20in\x20meters\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x0a\x20\x20\x20\x20float\x20term1\x20=\x20111132.92;\x0a\x20\x20\x20\x20float\x20term2\x20=\x20559.82\x20*\x20cos(2.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term3\x20=\x201.175\x20*\x20cos(4.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term4\x20=\x200.0023\x20*\x20cos(6.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20latLength\x20=\x20term1\x20-\x20term2\x20+\x20term3\x20-\x20term4;\x0a\x0a\x20\x20\x20\x20float\x20term5\x20=\x20111412.84\x20*\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20term6\x20=\x2093.5\x20*\x20cos(3.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20term7\x20=\x200.118\x20*\x20cos(5.0\x20*\x20latitude);\x0a\x20\x20\x20\x20float\x20longLength\x20=\x20term5\x20-\x20term6\x20+\x20term7;\x0a\x0a\x20\x20\x20\x20return\x20vec2(longLength,\x20latLength);\x0a}\x0a\x0avoid\x20updatePosition(vec3\x20lonLatLev,\x20vec3\x20speed)\x20{\x0a\x20\x20\x20\x20vec2\x20lonLatLength\x20=\x20lengthOfLonLat(lonLatLev);\x0a\x20\x20\x20\x20float\x20u\x20=\x20speed.x\x20/\x20lonLatLength.x;\x0a\x20\x20\x20\x20float\x20v\x20=\x20speed.y\x20/\x20lonLatLength.y;\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20vec3\x20windVectorInLonLatLev\x20=\x20vec3(u,\x20v,\x20w);\x0a\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20lonLatLev\x20+\x20windVectorInLonLatLev;\x0a\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20speed\x20=\x20texture(currentParticlesSpeed,\x20v_textureCoordinates).rgb;\x0a\x0a\x20\x20\x20\x20updatePosition(lonLatLev,\x20speed);\x0a}\x0a',postProcessingPosition_frag='uniform\x20sampler2D\x20nextParticlesPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x20//\x20(u,\x20v,\x20w,\x20normalization)\x0a\x0a//\x20range\x20(min,\x20max)\x0auniform\x20vec2\x20lonRange;\x0auniform\x20vec2\x20latRange;\x0a\x0auniform\x20float\x20randomCoefficient;\x20//\x20use\x20to\x20improve\x20the\x20pseudo-random\x20generator\x0auniform\x20float\x20dropRate;\x20//\x20drop\x20rate\x20is\x20a\x20chance\x20a\x20particle\x20will\x20restart\x20at\x20random\x20position\x20to\x20avoid\x20degeneration\x0auniform\x20float\x20dropRateBump;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0a//\x20pseudo-random\x20generator\x0aconst\x20vec3\x20randomConstants\x20=\x20vec3(12.9898,\x2078.233,\x204375.85453);\x0aconst\x20vec2\x20normalRange\x20=\x20vec2(0.0,\x201.0);\x0afloat\x20rand(vec2\x20seed,\x20vec2\x20range)\x20{\x0a\x20\x20\x20\x20vec2\x20randomSeed\x20=\x20randomCoefficient\x20*\x20seed;\x0a\x20\x20\x20\x20float\x20temp\x20=\x20dot(randomConstants.xy,\x20randomSeed);\x0a\x20\x20\x20\x20temp\x20=\x20fract(sin(temp)\x20*\x20(randomConstants.z\x20+\x20temp));\x0a\x20\x20\x20\x20return\x20temp\x20*\x20(range.y\x20-\x20range.x)\x20+\x20range.x;\x0a}\x0a\x0avec3\x20generateRandomParticle(vec2\x20seed,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20longitude\x20is\x20in\x20[0,\x20360]\x0a\x20\x20\x20\x20float\x20randomLon\x20=\x20mod(rand(seed,\x20lonRange),\x20360.0);\x0a\x20\x20\x20\x20float\x20randomLat\x20=\x20rand(-seed,\x20latRange);\x0a\x0a\x20\x20\x20\x20return\x20vec3(randomLon,\x20randomLat,\x20lev);\x0a}\x0a\x0abool\x20particleOutbound(vec3\x20particle)\x20{\x0a\x20\x20\x20\x20return\x20particle.y\x20<\x20-90.0\x20||\x20particle.y\x20>\x2090.0;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec3\x20nextParticle\x20=\x20texture(nextParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec4\x20nextSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20float\x20particleDropRate\x20=\x20dropRate\x20+\x20dropRateBump\x20*\x20nextSpeed.a;\x0a\x0a\x20\x20\x20\x20vec2\x20seed1\x20=\x20nextParticle.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec2\x20seed2\x20=\x20nextSpeed.xy\x20+\x20v_textureCoordinates;\x0a\x20\x20\x20\x20vec3\x20randomParticle\x20=\x20generateRandomParticle(seed1,\x20nextParticle.z);\x0a\x20\x20\x20\x20float\x20randomNumber\x20=\x20rand(seed2,\x20normalRange);\x0a\x0a\x20\x20\x20\x20if\x20(randomNumber\x20<\x20particleDropRate\x20||\x20particleOutbound(nextParticle))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(randomParticle,\x201.0);\x20//\x201.0\x20means\x20this\x20is\x20a\x20random\x20particle\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(nextParticle,\x200.0);\x0a\x20\x20\x20\x20}\x0a}\x0a',postProcessingSpeed_frag='uniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20nextParticlesSpeed;\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec4\x20randomParticle\x20=\x20texture(postProcessingPosition,\x20v_textureCoordinates);\x0a\x20\x20\x20\x20vec4\x20particleSpeed\x20=\x20texture(nextParticlesSpeed,\x20v_textureCoordinates);\x0a\x0a\x20\x20\x20\x20if\x20(randomParticle.a\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20out_FragColor\x20=\x20particleSpeed;\x0a\x20\x20\x20\x20}\x0a}\x0a';const Cesium$3=mars3d__namespace['Cesium'];class ParticlesComputing{constructor(_0x5db189,_0x53530f,_0x1476fd,_0x107618){const _0x1bed5b=_0x11ff57;this[_0x1bed5b(0x174)]=_0x53530f,this['createWindTextures'](_0x5db189,_0x53530f),this['createParticlesTextures'](_0x5db189,_0x1476fd,_0x107618),this['createComputingPrimitives'](_0x53530f,_0x1476fd,_0x107618);}[_0x11ff57(0x215)](_0x27559f,_0x218954){const _0x442827=_0x11ff57,_0x3d90a4={'context':_0x27559f,'width':_0x218954['dimensions'][_0x442827(0x1c0)],'height':_0x218954['dimensions']['lat']*(_0x218954[_0x442827(0x25b)][_0x442827(0x1b6)]||0x1),'pixelFormat':Cesium$3['PixelFormat']['LUMINANCE'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x442827(0x1d9)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3[_0x442827(0x1f2)]['NEAREST'],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})};this['windTextures']={'U':Util['createTexture'](_0x3d90a4,_0x218954['U'][_0x442827(0x1c1)]),'V':Util[_0x442827(0x1ef)](_0x3d90a4,_0x218954['V']['array'])};}[_0x11ff57(0x1de)](_0x4243e1,_0x4be132,_0x408e4d){const _0x1c29b0=_0x11ff57,_0xbdd3d5={'context':_0x4243e1,'width':_0x4be132['particlesTextureSize'],'height':_0x4be132[_0x1c29b0(0x255)],'pixelFormat':Cesium$3['PixelFormat']['RGBA'],'pixelDatatype':Cesium$3['PixelDatatype'][_0x1c29b0(0x1d9)],'flipY':![],'sampler':new Cesium$3['Sampler']({'minificationFilter':Cesium$3['TextureMinificationFilter'][_0x1c29b0(0x1ca)],'magnificationFilter':Cesium$3['TextureMagnificationFilter']['NEAREST']})},_0x54ee66=this['randomizeParticles'](_0x4be132[_0x1c29b0(0x205)],_0x408e4d),_0x572928=new Float32Array(0x4*_0x4be132['maxParticles'])['fill'](0x0);this['particlesTextures']={'particlesWind':Util['createTexture'](_0xbdd3d5),'currentParticlesPosition':Util['createTexture'](_0xbdd3d5,_0x54ee66),'nextParticlesPosition':Util['createTexture'](_0xbdd3d5,_0x54ee66),'currentParticlesSpeed':Util['createTexture'](_0xbdd3d5,_0x572928),'nextParticlesSpeed':Util['createTexture'](_0xbdd3d5,_0x572928),'postProcessingPosition':Util['createTexture'](_0xbdd3d5,_0x54ee66),'postProcessingSpeed':Util['createTexture'](_0xbdd3d5,_0x572928)};}['randomizeParticles'](_0x2a3940,_0x28d2ed){const _0x1d3f7a=_0x11ff57,_0x2f3c15=new Float32Array(0x4*_0x2a3940);for(let _0x1df813=0x0;_0x1df813<_0x2a3940;_0x1df813++){_0x2f3c15[0x4*_0x1df813]=Cesium$3[_0x1d3f7a(0x253)][_0x1d3f7a(0x232)](_0x28d2ed['lonRange']['x'],_0x28d2ed['lonRange']['y']),_0x2f3c15[0x4*_0x1df813+0x1]=Cesium$3['Math']['randomBetween'](_0x28d2ed['latRange']['x'],_0x28d2ed['latRange']['y']),_0x2f3c15[0x4*_0x1df813+0x2]=Cesium$3['Math']['randomBetween'](this['data']['lev']['min'],this['data']['lev']['max']),_0x2f3c15[0x4*_0x1df813+0x3]=0x0;}return _0x2f3c15;}['destroyParticlesTextures'](){const _0x30e6d8=_0x11ff57;Object[_0x30e6d8(0x176)](this['particlesTextures'])[_0x30e6d8(0x1b8)](_0x23aa04=>{this['particlesTextures'][_0x23aa04]['destroy']();});}[_0x11ff57(0x1b0)](_0x552fc8,_0x1fe854,_0x1acb6f){const _0x420883=_0x11ff57,_0x24d318=new Cesium$3[(_0x420883(0x209))](_0x552fc8['dimensions']['lon'],_0x552fc8[_0x420883(0x25b)]['lat'],_0x552fc8['dimensions'][_0x420883(0x1b6)]),_0x2e1be1=new Cesium$3['Cartesian3'](_0x552fc8[_0x420883(0x1c0)]['min'],_0x552fc8['lat']['min'],_0x552fc8[_0x420883(0x1b6)]['min']),_0x469c7=new Cesium$3[(_0x420883(0x209))](_0x552fc8['lon']['max'],_0x552fc8['lat'][_0x420883(0x237)],_0x552fc8['lev']['max']),_0x3131a4=new Cesium$3[(_0x420883(0x209))]((_0x469c7['x']-_0x2e1be1['x'])/(_0x24d318['x']-0x1),(_0x469c7['y']-_0x2e1be1['y'])/(_0x24d318['y']-0x1),_0x24d318['z']>0x1?(_0x469c7['z']-_0x2e1be1['z'])/(_0x24d318['z']-0x1):0x1),_0x252fb3=new Cesium$3['Cartesian2'](_0x552fc8['U'][_0x420883(0x21f)],_0x552fc8['U'][_0x420883(0x237)]),_0x24426b=new Cesium$3['Cartesian2'](_0x552fc8['V'][_0x420883(0x21f)],_0x552fc8['V'][_0x420883(0x237)]),_0x375f06=this;this['primitives']={'getWind':new CustomPrimitive({'commandType':'Compute','uniformMap':{'U':function(){return _0x375f06['windTextures']['U'];},'V':function(){return _0x375f06['windTextures']['V'];},'currentParticlesPosition':function(){return _0x375f06['particlesTextures']['currentParticlesPosition'];},'dimension':function(){return _0x24d318;},'minimum':function(){return _0x2e1be1;},'maximum':function(){return _0x469c7;},'interval':function(){return _0x3131a4;}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[getWind_frag]}),'outputTexture':this['particlesTextures']['particlesWind'],'preExecute':function(){const _0x50981a=_0x420883;_0x375f06['primitives']['getWind'][_0x50981a(0x23c)]['outputTexture']=_0x375f06['particlesTextures']['particlesWind'];}}),'updateSpeed':new CustomPrimitive({'commandType':'Compute','uniformMap':{'currentParticlesSpeed':function(){const _0x16dbc0=_0x420883;return _0x375f06[_0x16dbc0(0x221)]['currentParticlesSpeed'];},'particlesWind':function(){const _0x5a203f=_0x420883;return _0x375f06[_0x5a203f(0x221)][_0x5a203f(0x21b)];},'uSpeedRange':function(){return _0x252fb3;},'vSpeedRange':function(){return _0x24426b;},'pixelSize':function(){const _0x1edf4c=_0x420883;return _0x1acb6f[_0x1edf4c(0x1af)];},'speedFactor':function(){return _0x1fe854['speedFactor'];}},'fragmentShaderSource':new Cesium$3[(_0x420883(0x173))]({'sources':[updateSpeed_frag]}),'outputTexture':this[_0x420883(0x221)]['nextParticlesSpeed'],'preExecute':function(){const _0x10e040=_0x420883,_0x44abd7=_0x375f06[_0x10e040(0x221)]['currentParticlesSpeed'];_0x375f06['particlesTextures']['currentParticlesSpeed']=_0x375f06['particlesTextures']['postProcessingSpeed'],_0x375f06[_0x10e040(0x221)]['postProcessingSpeed']=_0x44abd7,_0x375f06[_0x10e040(0x1ad)]['updateSpeed']['commandToExecute']['outputTexture']=_0x375f06[_0x10e040(0x221)]['nextParticlesSpeed'];}}),'updatePosition':new CustomPrimitive({'commandType':_0x420883(0x243),'uniformMap':{'currentParticlesPosition':function(){const _0x5a7f49=_0x420883;return _0x375f06[_0x5a7f49(0x221)][_0x5a7f49(0x192)];},'currentParticlesSpeed':function(){return _0x375f06['particlesTextures']['currentParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3[(_0x420883(0x173))]({'sources':[updatePosition_frag]}),'outputTexture':this['particlesTextures'][_0x420883(0x20b)],'preExecute':function(){const _0x3eda6f=_0x420883,_0x540d7c=_0x375f06['particlesTextures']['currentParticlesPosition'];_0x375f06[_0x3eda6f(0x221)]['currentParticlesPosition']=_0x375f06['particlesTextures']['postProcessingPosition'],_0x375f06['particlesTextures']['postProcessingPosition']=_0x540d7c,_0x375f06['primitives'][_0x3eda6f(0x1c3)][_0x3eda6f(0x23c)][_0x3eda6f(0x227)]=_0x375f06['particlesTextures']['nextParticlesPosition'];}}),'postProcessingPosition':new CustomPrimitive({'commandType':_0x420883(0x243),'uniformMap':{'nextParticlesPosition':function(){return _0x375f06['particlesTextures']['nextParticlesPosition'];},'nextParticlesSpeed':function(){const _0x22a8d6=_0x420883;return _0x375f06[_0x22a8d6(0x221)]['nextParticlesSpeed'];},'lonRange':function(){const _0xbc39f7=_0x420883;return _0x1acb6f[_0xbc39f7(0x238)];},'latRange':function(){return _0x1acb6f['latRange'];},'randomCoefficient':function(){const _0x3303d1=_0x420883,_0x277e89=Math[_0x3303d1(0x185)]();return _0x277e89;},'dropRate':function(){return _0x1fe854['dropRate'];},'dropRateBump':function(){return _0x1fe854['dropRateBump'];}},'fragmentShaderSource':new Cesium$3[(_0x420883(0x173))]({'sources':[postProcessingPosition_frag]}),'outputTexture':this['particlesTextures'][_0x420883(0x230)],'preExecute':function(){const _0x567260=_0x420883;_0x375f06[_0x567260(0x1ad)][_0x567260(0x230)][_0x567260(0x23c)]['outputTexture']=_0x375f06['particlesTextures']['postProcessingPosition'];}}),'postProcessingSpeed':new CustomPrimitive({'commandType':_0x420883(0x243),'uniformMap':{'postProcessingPosition':function(){return _0x375f06['particlesTextures']['postProcessingPosition'];},'nextParticlesSpeed':function(){return _0x375f06['particlesTextures']['nextParticlesSpeed'];}},'fragmentShaderSource':new Cesium$3['ShaderSource']({'sources':[postProcessingSpeed_frag]}),'outputTexture':this['particlesTextures']['postProcessingSpeed'],'preExecute':function(){_0x375f06['primitives']['postProcessingSpeed']['commandToExecute']['outputTexture']=_0x375f06['particlesTextures']['postProcessingSpeed'];}})};}}function _0x5107(){const _0x2a1af7=['keys','commandList','south','rawRenderState','vdata','visible','pointerEvents','segments','canrefresh','geometry','show','uniformMap','abs','layer','refreshTimer','random','in\x20vec2\x20st;\x0a//\x20it\x20is\x20not\x20normal\x20itself,\x20but\x20used\x20to\x20control\x20normal\x0ain\x20vec3\x20normal;\x20//\x20(point\x20to\x20use,\x20offset\x20sign,\x20not\x20used\x20component)\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x0auniform\x20sampler2D\x20postProcessingPosition;\x0auniform\x20sampler2D\x20postProcessingSpeed;\x0a\x0auniform\x20float\x20particleHeight;\x0a\x0auniform\x20float\x20aspect;\x0auniform\x20float\x20pixelSize;\x0auniform\x20float\x20lineWidth;\x0a\x0aout\x20float\x20speedNormalization;\x0a\x0avec3\x20convertCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20WGS84\x20(lon,\x20lat,\x20lev)\x20->\x20ECEF\x20(x,\x20y,\x20z)\x0a\x20\x20\x20\x20//\x20see\x20https://en.wikipedia.org/wiki/Geographic_coordinate_conversion#From_geodetic_to_ECEF_coordinates\x20for\x20detail\x0a\x0a\x20\x20\x20\x20//\x20WGS\x2084\x20geometric\x20constants\x0a\x20\x20\x20\x20float\x20a\x20=\x206378137.0;\x20//\x20Semi-major\x20axis\x0a\x20\x20\x20\x20float\x20b\x20=\x206356752.3142;\x20//\x20Semi-minor\x20axis\x0a\x20\x20\x20\x20float\x20e2\x20=\x206.69437999014e-3;\x20//\x20First\x20eccentricity\x20squared\x0a\x0a\x20\x20\x20\x20float\x20latitude\x20=\x20radians(lonLatLev.y);\x0a\x20\x20\x20\x20float\x20longitude\x20=\x20radians(lonLatLev.x);\x0a\x0a\x20\x20\x20\x20float\x20cosLat\x20=\x20cos(latitude);\x0a\x20\x20\x20\x20float\x20sinLat\x20=\x20sin(latitude);\x0a\x20\x20\x20\x20float\x20cosLon\x20=\x20cos(longitude);\x0a\x20\x20\x20\x20float\x20sinLon\x20=\x20sin(longitude);\x0a\x0a\x20\x20\x20\x20float\x20N_Phi\x20=\x20a\x20/\x20sqrt(1.0\x20-\x20e2\x20*\x20sinLat\x20*\x20sinLat);\x0a\x20\x20\x20\x20float\x20h\x20=\x20particleHeight;\x20//\x20it\x20should\x20be\x20high\x20enough\x20otherwise\x20the\x20particle\x20may\x20not\x20pass\x20the\x20terrain\x20depth\x20test\x0a\x0a\x20\x20\x20\x20vec3\x20cartesian\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20cartesian.x\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20cosLon;\x0a\x20\x20\x20\x20cartesian.y\x20=\x20(N_Phi\x20+\x20h)\x20*\x20cosLat\x20*\x20sinLon;\x0a\x20\x20\x20\x20cartesian.z\x20=\x20((b\x20*\x20b)\x20/\x20(a\x20*\x20a)\x20*\x20N_Phi\x20+\x20h)\x20*\x20sinLat;\x0a\x20\x20\x20\x20return\x20cartesian;\x0a}\x0a\x0avec4\x20calcProjectedCoordinate(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20the\x20range\x20of\x20longitude\x20in\x20Cesium\x20is\x20[-180,\x20180]\x20but\x20the\x20range\x20of\x20longitude\x20in\x20the\x20NetCDF\x20file\x20is\x20[0,\x20360]\x0a\x20\x20\x20\x20//\x20[0,\x20180]\x20is\x20corresponding\x20to\x20[0,\x20180]\x20and\x20[180,\x20360]\x20is\x20corresponding\x20to\x20[-180,\x200]\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x\x20+\x20180.0,\x20360.0)\x20-\x20180.0;\x0a\x20\x20\x20\x20vec3\x20particlePosition\x20=\x20convertCoordinate(lonLatLev);\x0a\x20\x20\x20\x20vec4\x20projectedCoordinate\x20=\x20czm_modelViewProjection\x20*\x20vec4(particlePosition,\x201.0);\x0a\x20\x20\x20\x20return\x20projectedCoordinate;\x0a}\x0a\x0avec4\x20calcOffset(vec4\x20currentProjectedCoordinate,\x20vec4\x20nextProjectedCoordinate,\x20float\x20offsetSign)\x20{\x0a\x20\x20\x20\x20vec2\x20aspectVec2\x20=\x20vec2(aspect,\x201.0);\x0a\x20\x20\x20\x20vec2\x20currentXY\x20=\x20(currentProjectedCoordinate.xy\x20/\x20currentProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x20\x20\x20\x20vec2\x20nextXY\x20=\x20(nextProjectedCoordinate.xy\x20/\x20nextProjectedCoordinate.w)\x20*\x20aspectVec2;\x0a\x0a\x20\x20\x20\x20float\x20offsetLength\x20=\x20lineWidth\x20/\x202.0;\x0a\x20\x20\x20\x20vec2\x20direction\x20=\x20normalize(nextXY\x20-\x20currentXY);\x0a\x20\x20\x20\x20vec2\x20normalVector\x20=\x20vec2(-direction.y,\x20direction.x);\x0a\x20\x20\x20\x20normalVector.x\x20=\x20normalVector.x\x20/\x20aspect;\x0a\x20\x20\x20\x20normalVector\x20=\x20offsetLength\x20*\x20normalVector;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20vec4(offsetSign\x20*\x20normalVector,\x200.0,\x200.0);\x0a\x20\x20\x20\x20return\x20offset;\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20vec2\x20particleIndex\x20=\x20st;\x0a\x0a\x20\x20\x20\x20vec3\x20currentPosition\x20=\x20texture(currentParticlesPosition,\x20particleIndex).rgb;\x0a\x20\x20\x20\x20vec4\x20nextPosition\x20=\x20texture(postProcessingPosition,\x20particleIndex);\x0a\x0a\x20\x20\x20\x20vec4\x20currentProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20vec4\x20nextProjectedCoordinate\x20=\x20vec4(0.0);\x0a\x20\x20\x20\x20if\x20(nextPosition.w\x20>\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20currentProjectedCoordinate\x20=\x20calcProjectedCoordinate(currentPosition);\x0a\x20\x20\x20\x20\x20\x20\x20\x20nextProjectedCoordinate\x20=\x20calcProjectedCoordinate(nextPosition.xyz);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20float\x20pointToUse\x20=\x20normal.x;\x20//\x20-1\x20is\x20currentProjectedCoordinate\x20and\x20+1\x20is\x20nextProjectedCoordinate\x0a\x20\x20\x20\x20float\x20offsetSign\x20=\x20normal.y;\x0a\x0a\x20\x20\x20\x20vec4\x20offset\x20=\x20pixelSize\x20*\x20calcOffset(currentProjectedCoordinate,\x20nextProjectedCoordinate,\x20offsetSign);\x0a\x20\x20\x20\x20if\x20(pointToUse\x20<\x200.0)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20currentProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20gl_Position\x20=\x20nextProjectedCoordinate\x20+\x20offset;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20speedNormalization\x20=\x20texture(postProcessingSpeed,\x20particleIndex).a;\x0a}\x0a','ComponentDatatype','hidden','tlat','depthMask','clearFramebuffers','windData','DrawCommand','speed','xmin','particles','style','currentParticlesPosition','worker','100848sfVIQX','reverseY','ymax','umax','toDegrees','fillRect','currentTrailsDepth','globalAlpha','update','_colorRamp','mouse_down','destroy','_maxAge','15OoBalF','primitiveType','height','_updateIng','latRange','186040LNTGPY','textures','_speedRate','blending','framebuffer','Texture','setData','primitives','left','pixelSize','createComputingPrimitives','createFramebuffer','init','vertexArray','_bilinearInterpolation','trails','lev','_pointerEvents','forEach','context','mouse_move','cols','_createCanvas','width','isInExtent','getOptions','lon','array','LayerUtil','updatePosition','visibility','vertexShaderSource','_onMap_preRenderEvent','rgb(206,255,255)','161996NmfYrd','ALWAYS','NEAREST','OPAQUE','fragmentShaderSource','CanvasWindField','toGridXY','options','clampToLatitudeRange','PI_OVER_TWO','STATIC_DRAW','speedRate','EventType','4278304iGSWWK','VertexArray','_onMouseMoveEvent','_tomap','FLOAT','fromGeometry','green','BufferUsage','canvasWind','createParticlesTextures','mouseDown','RGB','ymin','uniform\x20sampler2D\x20colorTable;\x0a\x0ain\x20float\x20speedNormalization;\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20out_FragColor\x20=\x20texture(colorTable,\x20vec2(speedNormalization,\x200.0));\x0a}\x0a','790074LSVlMQ','Cartesian2','getRandomLatLng','removeEventListener','defined','particleSystem','Cesium','source','fixedHeight','createRawRenderState','isDestroy','getFullscreenQuad','createTexture','off','Color','TextureMinificationFilter','refreshParticles','_mountedHook','getUVByXY','bindEvent','attributeLocations','sqrt','clientHeight','ComputeCommand','canvasHeight','clientWidth','toRadians','canvasContext','camera','_setOptionsHook','_showHook','bind','rows','tlng','maxParticles','redraw','none','createSegmentsGeometry','Cartesian3','unbindEvent','nextParticlesPosition','_calcUV','maxAge','GeometryAttributes','220530QTaFPe','_onMouseUpEvent','_drawLines','drawingBufferHeight','getDefaultRenderState','resize','createWindTextures','windField','clearCommand','lineWidth','Geometry','add','particlesWind','colors','lat','frameTime','min','_data','particlesTextures','154105ikJKUQ','getUVByPoint','wheel','canvas','addPrimitives','outputTexture','grid','xmax','push','strokeStyle','_onMapWhellEvent','scene','register','commandType','postProcessingPosition','particlesComputing','randomBetween','container','_removedHook','globeBoundingSphere','viewerParameters','max','lonRange','destination-in','lineTo','_addedHook','commandToExecute','WindLayer','Rectangle','_randomParticle','nextTrails','framebuffers','drawingBufferWidth','Compute','clear','_onMouseDownEvent','canvasWidth','west','color','execute','//\x20the\x20size\x20of\x20UV\x20textures:\x20width\x20=\x20lon,\x20height\x20=\x20lat*lev\x0auniform\x20sampler2D\x20U;\x20//\x20eastward\x20wind\x0auniform\x20sampler2D\x20V;\x20//\x20northward\x20wind\x0a\x0auniform\x20sampler2D\x20currentParticlesPosition;\x20//\x20(lon,\x20lat,\x20lev)\x0a\x0auniform\x20vec3\x20dimension;\x20//\x20(lon,\x20lat,\x20lev)\x0auniform\x20vec3\x20minimum;\x20//\x20minimum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20maximum;\x20//\x20maximum\x20of\x20each\x20dimension\x0auniform\x20vec3\x20interval;\x20//\x20interval\x20of\x20each\x20dimension\x0a\x0ain\x20vec2\x20v_textureCoordinates;\x0a\x0avec2\x20mapPositionToNormalizedIndex2D(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20ensure\x20the\x20range\x20of\x20longitude\x20and\x20latitude\x0a\x20\x20\x20\x20lonLatLev.x\x20=\x20mod(lonLatLev.x,\x20360.0);\x0a\x20\x20\x20\x20lonLatLev.y\x20=\x20clamp(lonLatLev.y,\x20-90.0,\x2090.0);\x0a\x0a\x20\x20\x20\x20vec3\x20index3D\x20=\x20vec3(0.0);\x0a\x20\x20\x20\x20index3D.x\x20=\x20(lonLatLev.x\x20-\x20minimum.x)\x20/\x20interval.x;\x0a\x20\x20\x20\x20index3D.y\x20=\x20(lonLatLev.y\x20-\x20minimum.y)\x20/\x20interval.y;\x0a\x20\x20\x20\x20index3D.z\x20=\x20(lonLatLev.z\x20-\x20minimum.z)\x20/\x20interval.z;\x0a\x0a\x20\x20\x20\x20//\x20the\x20st\x20texture\x20coordinate\x20corresponding\x20to\x20(col,\x20row)\x20index\x0a\x20\x20\x20\x20//\x20example\x0a\x20\x20\x20\x20//\x20data\x20array\x20is\x20[0,\x201,\x202,\x203,\x204,\x205],\x20width\x20=\x203,\x20height\x20=\x202\x0a\x20\x20\x20\x20//\x20the\x20content\x20of\x20texture\x20will\x20be\x0a\x20\x20\x20\x20//\x20t\x201.0\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x203\x204\x205\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x0a\x20\x20\x20\x20//\x20\x20\x20\x20|\x20\x200\x201\x202\x0a\x20\x20\x20\x20//\x20\x20\x200.0------1.0\x20s\x0a\x0a\x20\x20\x20\x20vec2\x20index2D\x20=\x20vec2(index3D.x,\x20index3D.z\x20*\x20dimension.y\x20+\x20index3D.y);\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20vec2(index2D.x\x20/\x20dimension.x,\x20index2D.y\x20/\x20(dimension.y\x20*\x20dimension.z));\x0a\x20\x20\x20\x20return\x20normalizedIndex2D;\x0a}\x0a\x0afloat\x20getWind(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20vec2\x20normalizedIndex2D\x20=\x20mapPositionToNormalizedIndex2D(lonLatLev);\x0a\x20\x20\x20\x20float\x20result\x20=\x20texture(windTexture,\x20normalizedIndex2D).r;\x0a\x20\x20\x20\x20return\x20result;\x0a}\x0a\x0aconst\x20mat4\x20kernelMatrix\x20=\x20mat4(\x0a\x20\x20\x20\x200.0,\x20-1.0,\x202.0,\x20-1.0,\x20//\x20first\x20column\x0a\x20\x20\x20\x202.0,\x200.0,\x20-5.0,\x203.0,\x20//\x20second\x20column\x0a\x20\x20\x20\x200.0,\x201.0,\x204.0,\x20-3.0,\x20//\x20third\x20column\x0a\x20\x20\x20\x200.0,\x200.0,\x20-1.0,\x201.0\x20//\x20fourth\x20column\x0a);\x0afloat\x20oneDimensionInterpolation(float\x20t,\x20float\x20p0,\x20float\x20p1,\x20float\x20p2,\x20float\x20p3)\x20{\x0a\x20\x20\x20\x20vec4\x20tVec4\x20=\x20vec4(1.0,\x20t,\x20t\x20*\x20t,\x20t\x20*\x20t\x20*\x20t);\x0a\x20\x20\x20\x20tVec4\x20=\x20tVec4\x20/\x202.0;\x0a\x20\x20\x20\x20vec4\x20pVec4\x20=\x20vec4(p0,\x20p1,\x20p2,\x20p3);\x0a\x20\x20\x20\x20return\x20dot((tVec4\x20*\x20kernelMatrix),\x20pVec4);\x0a}\x0a\x0afloat\x20calculateB(sampler2D\x20windTexture,\x20float\x20t,\x20float\x20lon,\x20float\x20lat,\x20float\x20lev)\x20{\x0a\x20\x20\x20\x20float\x20lon0\x20=\x20floor(lon)\x20-\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon1\x20=\x20floor(lon);\x0a\x20\x20\x20\x20float\x20lon2\x20=\x20floor(lon)\x20+\x201.0\x20*\x20interval.x;\x0a\x20\x20\x20\x20float\x20lon3\x20=\x20floor(lon)\x20+\x202.0\x20*\x20interval.x;\x0a\x0a\x20\x20\x20\x20float\x20p0\x20=\x20getWind(windTexture,\x20vec3(lon0,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p1\x20=\x20getWind(windTexture,\x20vec3(lon1,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p2\x20=\x20getWind(windTexture,\x20vec3(lon2,\x20lat,\x20lev));\x0a\x20\x20\x20\x20float\x20p3\x20=\x20getWind(windTexture,\x20vec3(lon3,\x20lat,\x20lev));\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(t,\x20p0,\x20p1,\x20p2,\x20p3);\x0a}\x0a\x0afloat\x20interpolateOneTexture(sampler2D\x20windTexture,\x20vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20float\x20lon\x20=\x20lonLatLev.x;\x0a\x20\x20\x20\x20float\x20lat\x20=\x20lonLatLev.y;\x0a\x20\x20\x20\x20float\x20lev\x20=\x20lonLatLev.z;\x0a\x0a\x20\x20\x20\x20float\x20lat0\x20=\x20floor(lat)\x20-\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat1\x20=\x20floor(lat);\x0a\x20\x20\x20\x20float\x20lat2\x20=\x20floor(lat)\x20+\x201.0\x20*\x20interval.y;\x0a\x20\x20\x20\x20float\x20lat3\x20=\x20floor(lat)\x20+\x202.0\x20*\x20interval.y;\x0a\x0a\x20\x20\x20\x20vec2\x20coefficient\x20=\x20lonLatLev.xy\x20-\x20floor(lonLatLev.xy);\x0a\x20\x20\x20\x20float\x20b0\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat0,\x20lev);\x0a\x20\x20\x20\x20float\x20b1\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat1,\x20lev);\x0a\x20\x20\x20\x20float\x20b2\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat2,\x20lev);\x0a\x20\x20\x20\x20float\x20b3\x20=\x20calculateB(windTexture,\x20coefficient.x,\x20lon,\x20lat3,\x20lev);\x0a\x0a\x20\x20\x20\x20return\x20oneDimensionInterpolation(coefficient.y,\x20b0,\x20b1,\x20b2,\x20b3);\x0a}\x0a\x0avec3\x20bicubic(vec3\x20lonLatLev)\x20{\x0a\x20\x20\x20\x20//\x20https://en.wikipedia.org/wiki/Bicubic_interpolation#Bicubic_convolution_algorithm\x0a\x20\x20\x20\x20float\x20u\x20=\x20interpolateOneTexture(U,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20v\x20=\x20interpolateOneTexture(V,\x20lonLatLev);\x0a\x20\x20\x20\x20float\x20w\x20=\x200.0;\x0a\x20\x20\x20\x20return\x20vec3(u,\x20v,\x20w);\x0a}\x0a\x0avoid\x20main()\x20{\x0a\x20\x20\x20\x20//\x20texture\x20coordinate\x20must\x20be\x20normalized\x0a\x20\x20\x20\x20vec3\x20lonLatLev\x20=\x20texture(currentParticlesPosition,\x20v_textureCoordinates).rgb;\x0a\x20\x20\x20\x20vec3\x20windVector\x20=\x20bicubic(lonLatLev);\x0a\x20\x20\x20\x20out_FragColor\x20=\x20vec4(windVector,\x200.0);\x0a}\x0a','udata','age','Draw','GeometryAttribute','TextureMagnificationFilter','requestAnimationFrame','initWorker','lng','Math','createCommand','particlesTextureSize','particlesRendering','postProcessingSpeed','globalCompositeOperation','getParticles','0px','dimensions','_map','setOptions','SCENE3D','particlesNumber','frameRate','ShaderSource','data','default'];_0x5107=function(){return _0x2a1af7;};return _0x5107();}const Cesium$2=mars3d__namespace[_0x11ff57(0x1e9)];class ParticleSystem{constructor(_0x1f58c6,_0xf4ff12,_0x2912c5,_0x1e812b){const _0x25c41b=_0x11ff57;this['context']=_0x1f58c6,_0xf4ff12={..._0xf4ff12},_0xf4ff12['udata']&&_0xf4ff12['vdata']&&(_0xf4ff12['dimensions']={},_0xf4ff12[_0x25c41b(0x25b)]['lon']=_0xf4ff12['cols'],_0xf4ff12['dimensions']['lat']=_0xf4ff12[_0x25c41b(0x203)],_0xf4ff12['dimensions']['lev']=_0xf4ff12['lev']||0x1,_0xf4ff12[_0x25c41b(0x1c0)]={},_0xf4ff12['lon'][_0x25c41b(0x21f)]=_0xf4ff12[_0x25c41b(0x18f)],_0xf4ff12['lon']['max']=_0xf4ff12[_0x25c41b(0x229)],_0xf4ff12['lat']={},_0xf4ff12[_0x25c41b(0x21d)]['min']=_0xf4ff12['ymin'],_0xf4ff12[_0x25c41b(0x21d)][_0x25c41b(0x237)]=_0xf4ff12['ymax'],_0xf4ff12['lev']={},_0xf4ff12['lev']['min']=_0xf4ff12['levmin']??0x1,_0xf4ff12['lev']['max']=_0xf4ff12['levmax']??0x1,_0xf4ff12['U']={},_0xf4ff12['U']['array']=new Float32Array(_0xf4ff12[_0x25c41b(0x24b)]),_0xf4ff12['U']['min']=_0xf4ff12['umin']??Math['min'](..._0xf4ff12[_0x25c41b(0x24b)]),_0xf4ff12['U']['max']=_0xf4ff12[_0x25c41b(0x197)]??Math['max'](..._0xf4ff12['udata']),_0xf4ff12['V']={},_0xf4ff12['V']['array']=new Float32Array(_0xf4ff12['vdata']),_0xf4ff12['V'][_0x25c41b(0x21f)]=_0xf4ff12['vmin']??Math[_0x25c41b(0x21f)](..._0xf4ff12['vdata']),_0xf4ff12['V']['max']=_0xf4ff12['vmax']??Math['max'](..._0xf4ff12[_0x25c41b(0x17a)])),this['data']=_0xf4ff12,this[_0x25c41b(0x1cf)]=_0x2912c5,this[_0x25c41b(0x236)]=_0x1e812b,this['particlesComputing']=new ParticlesComputing(this['context'],this['data'],this['options'],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this[_0x25c41b(0x174)],this[_0x25c41b(0x1cf)],this['viewerParameters'],this[_0x25c41b(0x231)]);}['canvasResize'](_0x348756){const _0xab97d5=_0x11ff57;this['particlesComputing']['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0xe76a6a=>{this['particlesComputing']['windTextures'][_0xe76a6a]['destroy']();}),this[_0xab97d5(0x256)]['textures']['colorTable'][_0xab97d5(0x19f)](),Object['keys'](this[_0xab97d5(0x256)][_0xab97d5(0x241)])[_0xab97d5(0x1b8)](_0x185173=>{const _0x285a65=_0xab97d5;this['particlesRendering']['framebuffers'][_0x185173][_0x285a65(0x19f)]();}),this['context']=_0x348756,this[_0xab97d5(0x231)]=new ParticlesComputing(this[_0xab97d5(0x1b9)],this[_0xab97d5(0x174)],this[_0xab97d5(0x1cf)],this['viewerParameters']),this['particlesRendering']=new ParticlesRendering(this['context'],this['data'],this['options'],this[_0xab97d5(0x236)],this['particlesComputing']);}[_0x11ff57(0x18b)](){const _0x271411=_0x11ff57,_0x4d1479=new Cesium$2['ClearCommand']({'color':new Cesium$2[(_0x271411(0x1f1))](0x0,0x0,0x0,0x0),'depth':0x1,'framebuffer':undefined,'pass':Cesium$2['Pass']['OPAQUE']});Object[_0x271411(0x176)](this[_0x271411(0x256)]['framebuffers'])['forEach'](_0x4f1288=>{const _0x1f54c4=_0x271411;_0x4d1479['framebuffer']=this[_0x1f54c4(0x256)]['framebuffers'][_0x4f1288],_0x4d1479[_0x1f54c4(0x249)](this['context']);});}[_0x11ff57(0x1f3)](_0x5d97f6){const _0x1d27d6=_0x11ff57;this['clearFramebuffers'](),this[_0x1d27d6(0x231)]['destroyParticlesTextures'](),this[_0x1d27d6(0x231)][_0x1d27d6(0x1de)](this['context'],this['options'],this['viewerParameters']);if(_0x5d97f6){var _0x4f043d;const _0x599e2e=this['particlesRendering']['createSegmentsGeometry'](this[_0x1d27d6(0x1cf)]);this['particlesRendering'][_0x1d27d6(0x1ad)]['segments']['geometry']=_0x599e2e;const _0x44a855=Cesium$2['VertexArray']['fromGeometry']({'context':this['context'],'geometry':_0x599e2e,'attributeLocations':this['particlesRendering'][_0x1d27d6(0x1ad)]['segments'][_0x1d27d6(0x1f7)],'bufferUsage':Cesium$2['BufferUsage']['STATIC_DRAW']});(_0x4f043d=this['particlesRendering']['primitives'])!==null&&_0x4f043d!==void 0x0&&(_0x4f043d=_0x4f043d[_0x1d27d6(0x17d)])!==null&&_0x4f043d!==void 0x0&&_0x4f043d['commandToExecute']&&(this[_0x1d27d6(0x256)]['primitives']['segments']['commandToExecute']['vertexArray']=_0x44a855);}}[_0x11ff57(0x16f)](_0x29f193){const _0x4d1ba8=_0x11ff57;let _0x102810=![];this[_0x4d1ba8(0x1cf)]['maxParticles']!==_0x29f193['maxParticles']&&(_0x102810=!![]),Object[_0x4d1ba8(0x176)](_0x29f193)['forEach'](_0x1cc826=>{this['options'][_0x1cc826]=_0x29f193[_0x1cc826];}),this['refreshParticles'](_0x102810);}['applyViewerParameters'](_0x556865){Object['keys'](_0x556865)['forEach'](_0x4fc68e=>{this['viewerParameters'][_0x4fc68e]=_0x556865[_0x4fc68e];}),this['refreshParticles'](![]);}['destroy'](){const _0x32a236=_0x11ff57;clearTimeout(this[_0x32a236(0x17e)]),this[_0x32a236(0x231)]['destroyParticlesTextures'](),Object['keys'](this['particlesComputing']['windTextures'])['forEach'](_0x13bc85=>{this['particlesComputing']['windTextures'][_0x13bc85]['destroy']();}),this['particlesRendering']['textures']['colorTable'][_0x32a236(0x19f)](),Object['keys'](this['particlesRendering']['framebuffers'])['forEach'](_0x400e1a=>{const _0x153e6c=_0x32a236;this['particlesRendering'][_0x153e6c(0x241)][_0x400e1a][_0x153e6c(0x19f)]();});for(const _0x1b100c in this){delete this[_0x1b100c];}}}const Cesium$1=mars3d__namespace['Cesium'],BaseLayer$1=mars3d__namespace[_0x11ff57(0x183)]['BaseLayer'],DEF_OPTIONS={'particlesNumber':0x1000,'fixedHeight':0x0,'fadeOpacity':0.996,'dropRate':0.003,'dropRateBump':0.01,'speedFactor':0.5,'lineWidth':0x2,'colors':[_0x11ff57(0x1c7)]};class WindLayer extends BaseLayer$1{constructor(_0x30679f={}){_0x30679f={...DEF_OPTIONS,..._0x30679f},super(_0x30679f),this['_setOptionsHook'](_0x30679f);}get['layer'](){return this['primitives'];}get['data'](){return this['_data'];}set[_0x11ff57(0x174)](_0x504fc7){this['setData'](_0x504fc7);}get[_0x11ff57(0x21c)](){const _0x224263=_0x11ff57;return this[_0x224263(0x1cf)]['colors'];}set[_0x11ff57(0x21c)](_0x353b07){const _0x4b6ac3=_0x11ff57;this['options']['colors']=_0x353b07,this['particleSystem']&&this['particleSystem'][_0x4b6ac3(0x16f)]({'colors':_0x353b07}),this['resize']();}[_0x11ff57(0x1f4)](){}['_addedHook'](){const _0x1ad444=_0x11ff57;this['scene']=this['_map']['scene'],this['camera']=this['_map']['camera'],this['primitives']=new Cesium$1['PrimitiveCollection'](),this['_map'][_0x1ad444(0x22d)]['primitives'][_0x1ad444(0x21a)](this[_0x1ad444(0x1ad)]),this[_0x1ad444(0x236)]={'lonRange':new Cesium$1[(_0x1ad444(0x1e4))](),'latRange':new Cesium$1[(_0x1ad444(0x1e4))](),'pixelSize':0x0},this[_0x1ad444(0x235)]=new Cesium$1['BoundingSphere'](Cesium$1['Cartesian3']['ZERO'],0.99*0x615299),this['updateViewerParameters'](),window['addEventListener'](_0x1ad444(0x214),this['resize']['bind'](this),![]),this['mouse_down']=![],this[_0x1ad444(0x1ba)]=![],this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this[_0x1ad444(0x25c)]['on'](mars3d__namespace['EventType']['mouseDown'],this[_0x1ad444(0x245)],this),this['_map']['on'](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this['_data']&&this[_0x1ad444(0x1ac)](this[_0x1ad444(0x220)]);}[_0x11ff57(0x234)](){const _0x2b68c0=_0x11ff57;window[_0x2b68c0(0x1e6)]('resize',this['resize']),this['_map'][_0x2b68c0(0x1f0)](mars3d__namespace['EventType']['preRender'],this[_0x2b68c0(0x1c6)],this),this[_0x2b68c0(0x25c)][_0x2b68c0(0x1f0)](mars3d__namespace['EventType']['wheel'],this[_0x2b68c0(0x22c)],this),this['_map']['off'](mars3d__namespace[_0x2b68c0(0x1d4)]['mouseDown'],this['_onMouseDownEvent'],this),this['_map'][_0x2b68c0(0x1f0)](mars3d__namespace['EventType']['mouseUp'],this[_0x2b68c0(0x210)],this),this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this[_0x2b68c0(0x1d7)],this),this['primitives']['removeAll'](),this['_map']['scene']['primitives']['remove'](this[_0x2b68c0(0x1ad)]);}[_0x11ff57(0x214)](){const _0x3ca00a=_0x11ff57;if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this[_0x3ca00a(0x1ad)]['removeAll'](),this['_map']['once'](mars3d__namespace['EventType']['preRender'],this['_onMap_preRenderEvent'],this);}['_onMap_preRenderEvent'](_0x3fe62a){const _0x38d1b9=_0x11ff57;this['particleSystem']['canvasResize'](this[_0x38d1b9(0x22d)]['context']),this['addPrimitives'](),this[_0x38d1b9(0x1ad)][_0x38d1b9(0x180)]=!![];}['_onMapWhellEvent'](_0x37d1e9){clearTimeout(this['refreshTimer']);if(!this['show']||!this['particleSystem'])return;this['primitives']['show']=![],this['refreshTimer']=setTimeout(()=>{if(!this['show'])return;this['redraw']();},0xc8);}['_onMouseDownEvent'](_0x575d50){const _0x27ea83=_0x11ff57;this[_0x27ea83(0x19e)]=!![];}['_onMouseMoveEvent'](_0x439cc8){const _0x3ecd62=_0x11ff57;if(!this['show']||!this[_0x3ecd62(0x1e8)])return;this['mouse_down']&&(this['primitives']['show']=![],this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x11147f){const _0x3ee435=_0x11ff57;if(!this['show']||!this['particleSystem'])return;this['mouse_down']&&this['mouse_move']&&this['redraw'](),this['primitives']['show']=!![],this[_0x3ee435(0x19e)]=![],this[_0x3ee435(0x1ba)]=![];}['redraw'](){const _0x13dfb5=_0x11ff57;if(!this['_map']||!this[_0x13dfb5(0x180)])return;this['updateViewerParameters'](),this['particleSystem']['applyViewerParameters'](this['viewerParameters']),this[_0x13dfb5(0x1ad)]['show']=!![];}[_0x11ff57(0x1ac)](_0x576cc2){const _0x3af1d0=_0x11ff57;this['_data']=_0x576cc2,this[_0x3af1d0(0x1e8)]&&this['particleSystem']['destroy'](),this['particleSystem']=new ParticleSystem(this[_0x3af1d0(0x22d)][_0x3af1d0(0x1b9)],_0x576cc2,this['getOptions'](),this['viewerParameters']),this[_0x3af1d0(0x226)]();}['_setOptionsHook'](_0x667ad,_0x313cd2){const _0x52c67b=_0x11ff57;if(_0x667ad)for(const _0x3bee32 in _0x667ad){this[_0x3bee32]=_0x667ad[_0x3bee32];}this['particleSystem']&&this['particleSystem'][_0x52c67b(0x16f)](this['getOptions']());}[_0x11ff57(0x1bf)](){const _0x45e27e=_0x11ff57,_0x17bdfb=Math['ceil'](Math['sqrt'](this['particlesNumber']));return this['particlesNumber']=_0x17bdfb*_0x17bdfb,{'particlesTextureSize':_0x17bdfb,'maxParticles':this[_0x45e27e(0x171)],'particleHeight':this[_0x45e27e(0x1eb)],'fadeOpacity':this['fadeOpacity'],'dropRate':this['dropRate'],'dropRateBump':this['dropRateBump'],'speedFactor':this['speedFactor'],'lineWidth':this['lineWidth'],'colors':this[_0x45e27e(0x21c)]};}['addPrimitives'](){const _0x5b19ff=_0x11ff57;this['primitives']['add'](this['particleSystem']['particlesComputing']['primitives']['getWind']),this[_0x5b19ff(0x1ad)]['add'](this['particleSystem']['particlesComputing'][_0x5b19ff(0x1ad)]['updateSpeed']),this[_0x5b19ff(0x1ad)]['add'](this[_0x5b19ff(0x1e8)]['particlesComputing']['primitives']['updatePosition']),this['primitives']['add'](this['particleSystem'][_0x5b19ff(0x231)]['primitives']['postProcessingPosition']),this['primitives']['add'](this[_0x5b19ff(0x1e8)]['particlesComputing']['primitives'][_0x5b19ff(0x257)]),this['primitives'][_0x5b19ff(0x21a)](this['particleSystem']['particlesRendering']['primitives'][_0x5b19ff(0x17d)]),this['primitives']['add'](this['particleSystem']['particlesRendering'][_0x5b19ff(0x1ad)][_0x5b19ff(0x1b5)]),this[_0x5b19ff(0x1ad)]['add'](this['particleSystem']['particlesRendering']['primitives']['screen']);}['updateViewerParameters'](){const _0x1afb34=_0x11ff57;let _0x21c71a=this['camera']['computeViewRectangle'](this['scene']['globe']['ellipsoid']);if(!_0x21c71a){const _0x40ae71=this['_map']['getExtent']();_0x21c71a=Cesium$1[_0x1afb34(0x23e)]['fromDegrees'](_0x40ae71['xmin'],_0x40ae71[_0x1afb34(0x1e1)],_0x40ae71['xmax'],_0x40ae71[_0x1afb34(0x196)]);}const _0x427123=Util['viewRectangleToLonLatRange'](_0x21c71a);this[_0x1afb34(0x236)][_0x1afb34(0x238)]['x']=_0x427123[_0x1afb34(0x1c0)]['min'],this[_0x1afb34(0x236)]['lonRange']['y']=_0x427123['lon'][_0x1afb34(0x237)],this['viewerParameters'][_0x1afb34(0x1a5)]['x']=_0x427123['lat']['min'],this['viewerParameters']['latRange']['y']=_0x427123[_0x1afb34(0x21d)][_0x1afb34(0x237)];const _0x2bcd8d=this[_0x1afb34(0x1ff)]['getPixelSize'](this['globeBoundingSphere'],this['scene']['drawingBufferWidth'],this[_0x1afb34(0x22d)]['drawingBufferHeight']);_0x2bcd8d>0x0&&(this['viewerParameters'][_0x1afb34(0x1af)]=_0x2bcd8d);}}mars3d__namespace['LayerUtil']['register']('wind',WindLayer),mars3d__namespace['layer'][_0x11ff57(0x23d)]=WindLayer;class CanvasParticle{constructor(){const _0x10c42f=_0x11ff57;this['lng']=null,this['lat']=null,this[_0x10c42f(0x204)]=null,this['tlat']=null,this[_0x10c42f(0x24c)]=null,this[_0x10c42f(0x18e)]=null;}['destroy'](){for(const _0x4b90e0 in this){delete this[_0x4b90e0];}}}class CanvasWindField{constructor(_0x2bec7e){this['setOptions'](_0x2bec7e);}get[_0x11ff57(0x1d3)](){const _0x59f616=_0x11ff57;return this[_0x59f616(0x1a8)];}set[_0x11ff57(0x1d3)](_0x48d06e){const _0x1b820c=_0x11ff57;this['_speedRate']=(0x64-(_0x48d06e>0x63?0x63:_0x48d06e))*0x64,this['_calc_speedRate']=[(this['xmax']-this[_0x1b820c(0x18f)])/this['_speedRate'],(this['ymax']-this['ymin'])/this['_speedRate']];}get['maxAge'](){return this['_maxAge'];}set['maxAge'](_0x2fa088){const _0x40dff9=_0x11ff57;this[_0x40dff9(0x1a0)]=_0x2fa088;}[_0x11ff57(0x16f)](_0x58c648){const _0x59f31d=_0x11ff57;this['options']=_0x58c648,this['maxAge']=_0x58c648[_0x59f31d(0x20d)]||0x78,this[_0x59f31d(0x1d3)]=_0x58c648['speedRate']||0x32,this['particles']=[];const _0x441327=_0x58c648[_0x59f31d(0x171)]||0x1000;for(let _0x299568=0x0;_0x299568<_0x441327;_0x299568++){const _0xfdbfeb=this[_0x59f31d(0x23f)](new CanvasParticle());this[_0x59f31d(0x190)][_0x59f31d(0x22a)](_0xfdbfeb);}}['setDate'](_0x2892cb){const _0x28e3e1=_0x11ff57;this['rows']=_0x2892cb['rows'],this['cols']=_0x2892cb['cols'],this['xmin']=_0x2892cb['xmin'],this['xmax']=_0x2892cb[_0x28e3e1(0x229)],this[_0x28e3e1(0x1e1)]=_0x2892cb['ymin'],this[_0x28e3e1(0x196)]=_0x2892cb['ymax'],this['grid']=[];const _0x5e32b8=_0x2892cb['udata'],_0xe99ed8=_0x2892cb['vdata'];let _0x38253a=![];_0x5e32b8['length']===this['rows']&&_0x5e32b8[0x0]['length']===this[_0x28e3e1(0x1bb)]&&(_0x38253a=!![]);let _0x261a6b=0x0,_0x10a63d=null,_0x56ce16=null;for(let _0x10b2c2=0x0;_0x10b2c2<this['rows'];_0x10b2c2++){_0x10a63d=[];for(let _0x440dcd=0x0;_0x440dcd<this[_0x28e3e1(0x1bb)];_0x440dcd++,_0x261a6b++){_0x38253a?_0x56ce16=this['_calcUV'](_0x5e32b8[_0x10b2c2][_0x440dcd],_0xe99ed8[_0x10b2c2][_0x440dcd]):_0x56ce16=this[_0x28e3e1(0x20c)](_0x5e32b8[_0x261a6b],_0xe99ed8[_0x261a6b]),_0x10a63d['push'](_0x56ce16);}this[_0x28e3e1(0x228)]['push'](_0x10a63d);}this[_0x28e3e1(0x1cf)]['reverseY']&&this[_0x28e3e1(0x228)]['reverse']();}['clear'](){const _0x344fa6=_0x11ff57;delete this[_0x344fa6(0x203)],delete this['cols'],delete this[_0x344fa6(0x18f)],delete this['xmax'],delete this['ymin'],delete this['ymax'],delete this['grid'],delete this['particles'];}['toGridXY'](_0x3554b6,_0x57a1b8){const _0x39d111=_0x11ff57,_0xdb0fa5=(_0x3554b6-this['xmin'])/(this[_0x39d111(0x229)]-this['xmin'])*(this[_0x39d111(0x1bb)]-0x1),_0xa20f45=(this['ymax']-_0x57a1b8)/(this['ymax']-this['ymin'])*(this['rows']-0x1);return[_0xdb0fa5,_0xa20f45];}['getUVByXY'](_0x2183e4,_0x358772){const _0x227158=_0x11ff57;if(_0x2183e4<0x0||_0x2183e4>=this['cols']||_0x358772>=this['rows'])return[0x0,0x0,0x0];const _0x56b907=Math['floor'](_0x2183e4),_0x3334b9=Math['floor'](_0x358772);if(_0x56b907===_0x2183e4&&_0x3334b9===_0x358772)return this[_0x227158(0x228)][_0x358772][_0x2183e4];const _0x4a50c9=_0x56b907+0x1,_0x3710a7=_0x3334b9+0x1,_0x1210e7=this[_0x227158(0x1f5)](_0x56b907,_0x3334b9),_0x5dfff0=this['getUVByXY'](_0x4a50c9,_0x3334b9),_0x4be4b7=this['getUVByXY'](_0x56b907,_0x3710a7),_0x280c72=this[_0x227158(0x1f5)](_0x4a50c9,_0x3710a7);let _0x46f926=null;try{_0x46f926=this[_0x227158(0x1b4)](_0x2183e4-_0x56b907,_0x358772-_0x3334b9,_0x1210e7,_0x5dfff0,_0x4be4b7,_0x280c72);}catch(_0x17dc79){console['log'](_0x2183e4,_0x358772);}return _0x46f926;}['_bilinearInterpolation'](_0x45ad52,_0x254e43,_0x2fb3c8,_0x3ce376,_0x1a3223,_0x2e8a7b){const _0x292249=_0x11ff57,_0x2681df=0x1-_0x45ad52,_0x25dd7e=0x1-_0x254e43,_0x196ec7=_0x2681df*_0x25dd7e,_0x4eb3e1=_0x45ad52*_0x25dd7e,_0x492d0c=_0x2681df*_0x254e43,_0x1cdcd0=_0x45ad52*_0x254e43,_0x33403b=_0x2fb3c8[0x0]*_0x196ec7+_0x3ce376[0x0]*_0x4eb3e1+_0x1a3223[0x0]*_0x492d0c+_0x2e8a7b[0x0]*_0x1cdcd0,_0x5c8c02=_0x2fb3c8[0x1]*_0x196ec7+_0x3ce376[0x1]*_0x4eb3e1+_0x1a3223[0x1]*_0x492d0c+_0x2e8a7b[0x1]*_0x1cdcd0;return this[_0x292249(0x20c)](_0x33403b,_0x5c8c02);}[_0x11ff57(0x20c)](_0x4d2c01,_0x3d17d3){const _0x3ad5e4=_0x11ff57;return[+_0x4d2c01,+_0x3d17d3,Math[_0x3ad5e4(0x1f8)](_0x4d2c01*_0x4d2c01+_0x3d17d3*_0x3d17d3)];}['getUVByPoint'](_0x372d1b,_0x3282a6){const _0x36b738=_0x11ff57;if(!this[_0x36b738(0x1be)](_0x372d1b,_0x3282a6))return null;const _0xe269ce=this[_0x36b738(0x1ce)](_0x372d1b,_0x3282a6),_0x32268a=this['getUVByXY'](_0xe269ce[0x0],_0xe269ce[0x1]);return _0x32268a;}['isInExtent'](_0x423038,_0x11a2c9){const _0x2f9cd5=_0x11ff57;return _0x423038>=this[_0x2f9cd5(0x18f)]&&_0x423038<=this['xmax']&&_0x11a2c9>=this[_0x2f9cd5(0x1e1)]&&_0x11a2c9<=this[_0x2f9cd5(0x196)]?!![]:![];}[_0x11ff57(0x1e5)](){const _0x237637=_0x11ff57,_0x23b845=fRandomByfloat(this[_0x237637(0x18f)],this[_0x237637(0x229)]),_0x3eb031=fRandomByfloat(this['ymin'],this['ymax']);return{'lat':_0x3eb031,'lng':_0x23b845};}[_0x11ff57(0x259)](){const _0x4bceca=_0x11ff57;let _0x3d56be,_0x304ae5,_0x196276;for(let _0x550635=0x0,_0x204eff=this['particles']['length'];_0x550635<_0x204eff;_0x550635++){let _0x571677=this[_0x4bceca(0x190)][_0x550635];_0x571677['age']<=0x0&&(_0x571677=this['_randomParticle'](_0x571677));if(_0x571677['age']>0x0){const _0x22c5d1=_0x571677['tlng'],_0x316f1a=_0x571677['tlat'];_0x196276=this[_0x4bceca(0x223)](_0x22c5d1,_0x316f1a),_0x196276?(_0x3d56be=_0x22c5d1+this['_calc_speedRate'][0x0]*_0x196276[0x0],_0x304ae5=_0x316f1a+this['_calc_speedRate'][0x1]*_0x196276[0x1],_0x571677['lng']=_0x22c5d1,_0x571677['lat']=_0x316f1a,_0x571677['tlng']=_0x3d56be,_0x571677[_0x4bceca(0x189)]=_0x304ae5,_0x571677['speed']=_0x196276[0x2],_0x571677['age']--):_0x571677[_0x4bceca(0x24c)]=0x0;}}return this['particles'];}['_randomParticle'](_0x35adf3){const _0x4f877d=_0x11ff57;let _0x3faa5f,_0x3fe1;for(let _0x500d98=0x0;_0x500d98<0x1e;_0x500d98++){_0x3faa5f=this['getRandomLatLng'](),_0x3fe1=this['getUVByPoint'](_0x3faa5f[_0x4f877d(0x252)],_0x3faa5f['lat']);if(_0x3fe1&&_0x3fe1[0x2]>0x0)break;}if(!_0x3fe1)return _0x35adf3;const _0x112a1f=_0x3faa5f['lng']+this['_calc_speedRate'][0x0]*_0x3fe1[0x0],_0x3004e2=_0x3faa5f['lat']+this['_calc_speedRate'][0x1]*_0x3fe1[0x1];return _0x35adf3['lng']=_0x3faa5f['lng'],_0x35adf3['lat']=_0x3faa5f[_0x4f877d(0x21d)],_0x35adf3['tlng']=_0x112a1f,_0x35adf3['tlat']=_0x3004e2,_0x35adf3[_0x4f877d(0x24c)]=Math['round'](Math['random']()*this[_0x4f877d(0x20d)]),_0x35adf3['speed']=_0x3fe1[0x2],_0x35adf3;}['destroy'](){for(const _0xb0f0c8 in this){delete this[_0xb0f0c8];}}}function fRandomByfloat(_0x8b7f15,_0x131450){return _0x8b7f15+Math['random']()*(_0x131450-_0x8b7f15);}const Cesium=mars3d__namespace['Cesium'],BaseLayer=mars3d__namespace['layer']['BaseLayer'];class CanvasWindLayer extends BaseLayer{constructor(_0x22f0be={}){const _0x1756b3=_0x11ff57;super(_0x22f0be),this[_0x1756b3(0x200)](_0x22f0be),this['canvas']=null,_0x22f0be['colors']&&_0x22f0be['steps']&&(this[_0x1756b3(0x19d)]=new mars3d__namespace['ColorRamp'](_0x22f0be));}['_setOptionsHook'](_0x1a627e,_0x211b93){const _0x2dda8=_0x11ff57;this['frameTime']=0x3e8/(_0x1a627e[_0x2dda8(0x172)]||0xa),this['_pointerEvents']=this['options'][_0x2dda8(0x17c)]??![],this['color']=_0x1a627e['color']||'#ffffff',this[_0x2dda8(0x218)]=_0x1a627e['lineWidth']||0x1,this[_0x2dda8(0x1eb)]=_0x1a627e['fixedHeight']??0x0,this['reverseY']=_0x1a627e[_0x2dda8(0x195)]??![],this['windField']&&this[_0x2dda8(0x216)][_0x2dda8(0x16f)](_0x1a627e);}get['layer'](){const _0x18ff9e=_0x11ff57;return this[_0x18ff9e(0x225)];}get['canvasWidth'](){const _0x493721=_0x11ff57;return this[_0x493721(0x25c)]['scene'][_0x493721(0x225)][_0x493721(0x1fc)];}get['canvasHeight'](){const _0x2035e7=_0x11ff57;return this[_0x2035e7(0x25c)]['scene']['canvas'][_0x2035e7(0x1f9)];}get['pointerEvents'](){const _0x456690=_0x11ff57;return this[_0x456690(0x1b7)];}set['pointerEvents'](_0x239d45){const _0x1a674f=_0x11ff57;this[_0x1a674f(0x1b7)]=_0x239d45;if(!this['canvas'])return;_0x239d45?this[_0x1a674f(0x225)][_0x1a674f(0x191)]['pointer-events']='all':this['canvas']['style']['pointer-events']=_0x1a674f(0x207);}get['particlesNumber'](){return this['options']['particlesNumber'];}set['particlesNumber'](_0x508d1f){this['options']['particlesNumber']=_0x508d1f,clearTimeout(this['_canrefresh']),this['_canrefresh']=setTimeout(()=>{const _0x2935d4=_0x1ef3;this[_0x2935d4(0x206)]();},0x1f4);}get[_0x11ff57(0x1d3)](){return this['options']['speedRate'];}set[_0x11ff57(0x1d3)](_0x40dede){const _0x37ac81=_0x11ff57;this[_0x37ac81(0x1cf)]['speedRate']=_0x40dede,this['windField']&&(this['windField']['speedRate']=_0x40dede);}get[_0x11ff57(0x20d)](){return this['options']['maxAge'];}set['maxAge'](_0x30e573){this['options']['maxAge']=_0x30e573,this['windField']&&(this['windField']['maxAge']=_0x30e573);}get[_0x11ff57(0x174)](){const _0x4d8251=_0x11ff57;return this[_0x4d8251(0x18c)];}set['data'](_0x9d6a12){this['setData'](_0x9d6a12);}[_0x11ff57(0x201)](_0x90404f){const _0x39fd71=_0x11ff57;_0x90404f?this[_0x39fd71(0x23b)]():(this['windData']&&(this[_0x39fd71(0x1cf)][_0x39fd71(0x174)]=this['windData']),this[_0x39fd71(0x234)]());}['_mountedHook'](){const _0x351489=_0x11ff57;this['options']['worker']?this[_0x351489(0x251)]():this['windField']=new CanvasWindField(this['options']);}[_0x11ff57(0x23b)](){const _0x24c012=_0x11ff57;this[_0x24c012(0x225)]=this[_0x24c012(0x1bc)](),this[_0x24c012(0x1fe)]=this['canvas']['getContext']('2d',{'willReadFrequently':!![]}),this[_0x24c012(0x1f6)](),this['options']['data']&&this['setData'](this[_0x24c012(0x1cf)]['data']);}['_removedHook'](){const _0x157a96=_0x11ff57;this[_0x157a96(0x244)](),this[_0x157a96(0x20a)](),this[_0x157a96(0x225)]&&(this['_map']['container']['removeChild'](this[_0x157a96(0x225)]),delete this['canvas']);}['_createCanvas'](){const _0x18e52a=_0x11ff57,_0x52a5c7=mars3d__namespace['DomUtil']['create']('canvas','mars3d-canvasWind',this[_0x18e52a(0x25c)][_0x18e52a(0x233)]);return _0x52a5c7['style']['position']='absolute',_0x52a5c7['style']['top']=_0x18e52a(0x25a),_0x52a5c7['style'][_0x18e52a(0x1ae)]=_0x18e52a(0x25a),_0x52a5c7['style'][_0x18e52a(0x1bd)]=this['_map']['scene']['canvas']['clientWidth']+'px',_0x52a5c7['style']['height']=this['_map']['scene']['canvas']['clientHeight']+'px',_0x52a5c7['style']['pointerEvents']=this['_pointerEvents']?'auto':'none',_0x52a5c7['style']['zIndex']=this['options']['zIndex']??0x9,_0x52a5c7['width']=this[_0x18e52a(0x25c)]['scene']['canvas']['clientWidth'],_0x52a5c7[_0x18e52a(0x1a3)]=this['_map']['scene']['canvas']['clientHeight'],_0x52a5c7;}[_0x11ff57(0x214)](){const _0x38c6bd=_0x11ff57;this[_0x38c6bd(0x225)]&&(this[_0x38c6bd(0x225)][_0x38c6bd(0x191)]['width']=this['_map']['scene']['canvas']['clientWidth']+'px',this[_0x38c6bd(0x225)][_0x38c6bd(0x191)]['height']=this[_0x38c6bd(0x25c)]['scene'][_0x38c6bd(0x225)][_0x38c6bd(0x1f9)]+'px',this['canvas'][_0x38c6bd(0x1bd)]=this['_map']['scene']['canvas']['clientWidth'],this['canvas']['height']=this['_map']['scene']['canvas']['clientHeight']);}['bindEvent'](){const _0x58df60=_0x11ff57,_0x14cfd3=this;let _0x33d5c6=Date['now']();(function _0xc28816(){const _0x61d739=_0x1ef3;if(_0x14cfd3[_0x61d739(0x1ed)])return;_0x14cfd3['_animateFrame']=window[_0x61d739(0x250)](_0xc28816);if(_0x14cfd3['show']&&_0x14cfd3['windField']){const _0x3e3df5=Date['now'](),_0x46e648=_0x3e3df5-_0x33d5c6;_0x46e648>_0x14cfd3[_0x61d739(0x21e)]&&(_0x33d5c6=_0x3e3df5-_0x46e648%_0x14cfd3[_0x61d739(0x21e)],_0x14cfd3[_0x61d739(0x19c)]());}}(),window['addEventListener']('resize',this['resize'][_0x58df60(0x202)](this),![]),this['mouse_down']=![],this['mouse_move']=![],this['options']['mouseHidden']&&(this['_map']['on'](mars3d__namespace['EventType']['wheel'],this['_onMapWhellEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseDown'],this['_onMouseDownEvent'],this),this[_0x58df60(0x25c)]['on'](mars3d__namespace['EventType']['mouseUp'],this[_0x58df60(0x210)],this)));}['unbindEvent'](){const _0x400b0b=_0x11ff57;window['cancelAnimationFrame'](this['_animateFrame']),delete this['_animateFrame'],window['removeEventListener']('resize',this['resize']),this['options']['mouseHidden']&&(this['_map'][_0x400b0b(0x1f0)](mars3d__namespace['EventType'][_0x400b0b(0x224)],this[_0x400b0b(0x22c)],this),this['_map']['off'](mars3d__namespace['EventType'][_0x400b0b(0x1df)],this['_onMouseDownEvent'],this),this[_0x400b0b(0x25c)][_0x400b0b(0x1f0)](mars3d__namespace['EventType']['mouseUp'],this['_onMouseUpEvent'],this),this['_map'][_0x400b0b(0x1f0)](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this));}['_onMapWhellEvent'](_0x725e2c){const _0x2aee3f=_0x11ff57;clearTimeout(this[_0x2aee3f(0x184)]);if(!this['show']||!this[_0x2aee3f(0x225)])return;this[_0x2aee3f(0x225)][_0x2aee3f(0x191)]['visibility']='hidden',this['refreshTimer']=setTimeout(()=>{const _0x5a3168=_0x2aee3f;if(!this['show'])return;this['redraw'](),this['canvas'][_0x5a3168(0x191)]['visibility']=_0x5a3168(0x17b);},0xc8);}[_0x11ff57(0x245)](_0x59ddc1){const _0x290c4b=_0x11ff57;this[_0x290c4b(0x19e)]=!![],this[_0x290c4b(0x25c)]['off'](mars3d__namespace[_0x290c4b(0x1d4)]['mouseMove'],this['_onMouseMoveEvent'],this),this['_map']['on'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this);}['_onMouseMoveEvent'](_0xdf228){const _0x3fe133=_0x11ff57;if(!this[_0x3fe133(0x180)]||!this[_0x3fe133(0x225)])return;this[_0x3fe133(0x19e)]&&(this['canvas']['style'][_0x3fe133(0x1c4)]=_0x3fe133(0x188),this['mouse_move']=!![]);}['_onMouseUpEvent'](_0x51544e){const _0x22e7e9=_0x11ff57;if(!this['show']||!this['canvas'])return;this['_map']['off'](mars3d__namespace['EventType']['mouseMove'],this['_onMouseMoveEvent'],this),this[_0x22e7e9(0x19e)]&&this['mouse_move']&&this['redraw'](),this['canvas']['style'][_0x22e7e9(0x1c4)]='visible',this['mouse_down']=![],this['mouse_move']=![];}['setData'](_0x19349c){const _0x13518e=_0x11ff57;this['clear'](),this[_0x13518e(0x18c)]=_0x19349c,this[_0x13518e(0x216)]['setDate'](_0x19349c),this[_0x13518e(0x206)]();}['redraw'](){const _0xb40fd4=_0x11ff57;if(!this[_0xb40fd4(0x180)])return;this['windField'][_0xb40fd4(0x16f)](this[_0xb40fd4(0x1cf)]),this[_0xb40fd4(0x19c)]();}['update'](){const _0x5c263f=_0x11ff57;if(this['_updateIng'])return;this['_updateIng']=!![];if(this[_0x5c263f(0x193)])this['windField']['update']();else{const _0x433af1=this['windField'][_0x5c263f(0x259)]();this[_0x5c263f(0x211)](_0x433af1);}this[_0x5c263f(0x1a4)]=![];}[_0x11ff57(0x211)](_0x266e54){const _0xd9e8ce=_0x11ff57;this['canvasContext'][_0xd9e8ce(0x258)]=_0xd9e8ce(0x239),this['canvasContext'][_0xd9e8ce(0x199)](0x0,0x0,this[_0xd9e8ce(0x246)],this[_0xd9e8ce(0x1fb)]),this['canvasContext']['globalCompositeOperation']='lighter',this['canvasContext'][_0xd9e8ce(0x19b)]=0.9;const _0x466f6b=this['_map']['scene']['mode']!==Cesium['SceneMode']['SCENE3D'],_0x3f617d=this['canvasWidth']*0.25;if(this[_0xd9e8ce(0x19d)])for(let _0x1433da=0x0,_0x141593=_0x266e54['length'];_0x1433da<_0x141593;_0x1433da++){const _0x822f78=_0x266e54[_0x1433da],_0x2685bf=this['_tomap'](_0x822f78['lng'],_0x822f78['lat'],_0x822f78),_0x34da42=this['_tomap'](_0x822f78['tlng'],_0x822f78['tlat'],_0x822f78);if(!_0x2685bf||!_0x34da42)continue;if(_0x466f6b&&Math[_0xd9e8ce(0x182)](_0x2685bf[0x0]-_0x34da42[0x0])>=_0x3f617d)continue;this['canvasContext']['beginPath'](),this[_0xd9e8ce(0x1fe)]['lineWidth']=this[_0xd9e8ce(0x218)],this['canvasContext'][_0xd9e8ce(0x22b)]=this[_0xd9e8ce(0x19d)]['getColor'](_0x822f78['speed']),this['canvasContext']['moveTo'](_0x2685bf[0x0],_0x2685bf[0x1]),this['canvasContext']['lineTo'](_0x34da42[0x0],_0x34da42[0x1]),this['canvasContext']['stroke']();}else{this['canvasContext']['beginPath'](),this[_0xd9e8ce(0x1fe)]['lineWidth']=this['lineWidth'],this['canvasContext']['strokeStyle']=this[_0xd9e8ce(0x248)];for(let _0x559989=0x0,_0xa77f30=_0x266e54['length'];_0x559989<_0xa77f30;_0x559989++){const _0x12fbd4=_0x266e54[_0x559989],_0x499d50=this['_tomap'](_0x12fbd4['lng'],_0x12fbd4['lat'],_0x12fbd4),_0x1e9448=this[_0xd9e8ce(0x1d8)](_0x12fbd4['tlng'],_0x12fbd4['tlat'],_0x12fbd4);if(!_0x499d50||!_0x1e9448)continue;if(_0x466f6b&&Math['abs'](_0x499d50[0x0]-_0x1e9448[0x0])>=_0x3f617d)continue;this['canvasContext']['moveTo'](_0x499d50[0x0],_0x499d50[0x1]),this['canvasContext'][_0xd9e8ce(0x23a)](_0x1e9448[0x0],_0x1e9448[0x1]);}this['canvasContext']['stroke']();}}[_0x11ff57(0x1d8)](_0x300dbb,_0x42d5ee,_0x4bf883){const _0x188df2=_0x11ff57,_0x3bb9a5=Cesium['Cartesian3']['fromDegrees'](_0x300dbb,_0x42d5ee,this['fixedHeight']),_0x1c9281=this[_0x188df2(0x25c)]['scene'];if(_0x1c9281['mode']===Cesium['SceneMode'][_0x188df2(0x170)]){const _0x20020e=new Cesium['EllipsoidalOccluder'](_0x1c9281['globe']['ellipsoid'],_0x1c9281[_0x188df2(0x1ff)]['positionWC']),_0x31fb2f=_0x20020e['isPointVisible'](_0x3bb9a5);if(!_0x31fb2f)return _0x4bf883[_0x188df2(0x24c)]=0x0,null;}const _0x4e2574=Cesium['SceneTransforms']['worldToWindowCoordinates'](this['_map'][_0x188df2(0x22d)],_0x3bb9a5);return _0x4e2574?[_0x4e2574['x'],_0x4e2574['y']]:null;}['clear'](){this['windField']['clear'](),delete this['windData'];}['initWorker'](){const _0x8b46a2=_0x11ff57;this['worker']=new Worker(this['options']['worker']),this[_0x8b46a2(0x193)]['onmessage']=_0x1e588c=>{const _0xe5c624=_0x8b46a2;this['_drawLines'](_0x1e588c[_0xe5c624(0x174)][_0xe5c624(0x190)]),this['_updateIng2']=![];},this['windField']={'init':_0x1a06bf=>{this['worker']['postMessage']({'type':'init','options':_0x1a06bf});},'setOptions':_0x536122=>{this['worker']['postMessage']({'type':'setOptions','options':_0x536122});},'setDate':_0x5f0d3f=>{this['worker']['postMessage']({'type':'setDate','data':_0x5f0d3f});},'update':()=>{if(this['_updateIng2'])return;this['_updateIng2']=!![],this['worker']['postMessage']({'type':'update'});},'clear':()=>{const _0x3de1d0=_0x8b46a2;this['worker']['postMessage']({'type':_0x3de1d0(0x244)});}},this[_0x8b46a2(0x216)][_0x8b46a2(0x1b2)](this['options']);}}mars3d__namespace[_0x11ff57(0x1c2)][_0x11ff57(0x22e)](_0x11ff57(0x1dd),CanvasWindLayer),mars3d__namespace['layer']['CanvasWindLayer']=CanvasWindLayer,mars3d__namespace['CanvasWindField']=CanvasWindField,mars3d__namespace['WindUtil']=WindUtil,exports[_0x11ff57(0x1cd)]=CanvasWindField,exports['CanvasWindLayer']=CanvasWindLayer,exports['WindLayer']=WindLayer,exports['WindUtil']=WindUtil,Object['defineProperty'](exports,'__esModule',{'value':!![]});
}));
