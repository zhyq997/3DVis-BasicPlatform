var T=(e,a,t)=>new Promise((o,l)=>{var d=i=>{try{m(t.next(i))}catch(_){l(_)}},y=i=>{try{m(t.throw(i))}catch(_){l(_)}},m=i=>i.done?o(i.value):Promise.resolve(i.value).then(d,y);m((t=t.apply(e,a)).next())});import{n as j}from"./antd-DgCI0x_J.js";import{m as f,$ as G,_ as U}from"./entry/index-BNp4bmLj-1732066199007.js";import{u as z}from"./use-lifecycle-CyVQVRUS.js";import{d as F,f as D,c as L,o as H,a7 as p,Z as J,a8 as W,a9 as r,k as n,$ as C,a0 as S,G as v,a2 as Z,a3 as q}from"./vue-D4H2Ux2Y.js";let c,s,Y;const K={scene:{center:{lat:33.596051,lng:119.031383,alt:359,heading:180,pitch:-43},fxaa:!0,globe:{baseColor:"#000"}}},x=new f.BaseClass;function Q(e){c=e,s=new f.thing.Shadows({darkness:1,multiplier:1600}),c.addThing(s),s.on(f.EventType.change,function(){const a=s.time;x.fire("changeShadows",{shadowTime:a})})}function X(){w(Y,12,0),$(),c=null}function A(){s&&s.isStart&&s.pause()}function P(e,a,t){const o=w(e,a,t),l=new Date(e+" 00:00:00"),d=new Date(e+" 23:59:59");s.multiplier=1600,s.start(l,d,o)}function w(e,a,t){const o=new Date(`${e} ${a}:${t}:00`);return s.time=o,o}function $(){s.clear(),c.graphicLayer.clear()}function E(e){return T(this,null,function*(){G("提示：不同视角下ShadowMap精度存在差异，分析结果会存在误差，尽量俯视整个区域进行分析。"),c.graphicLayer.clear();const t=(yield c.graphicLayer.startDraw({type:"polygon",style:{color:"#007be6",opacity:.5,clampToGround:!0}})).positionsShow;c.graphicLayer.clear(),s.multiplier=14400;const o=yield s.startRate({startDate:new Date(e+" 08:00:00"),endDate:new Date(e+" 18:00:00"),positions:t,step:3,minHeight:20});ae(o)})}const ee=new f.ColorRamp({steps:[5,15,25,35,50,80],colors:["rgb(0, 228, 0)","rgb(256, 256, 0)","rgb(256, 126, 0)","rgb(256, 0, 0)","rgb(153, 0, 76)","rgb(126, 0, 35)"]});function ae(e){c.graphicLayer.clear(),e.positions.forEach((a,t)=>{const o=a.rate*100,l=new f.graphic.PointEntity({position:a,style:{pixelSize:10,color:ee.getColor(o)},popup:`阴影率: ${o.toFixed(2)}%`});c.graphicLayer.addGraphic(l)})}function R(e){Y=e}const te=Object.freeze(Object.defineProperty({__proto__:null,clearArea:$,drawArea:E,eventTarget:x,getCurreDate:R,get map(){return c},mapOptions:K,onMounted:Q,onUnmounted:X,setShadows:w,startPlay:P,stopPlay:A},Symbol.toStringTag,{value:"Module"})),B=e=>(Z("data-v-c0775c19"),e=e(),q(),e),oe=B(()=>C("div",{class:"title-vertical_line"},"日照效果",-1)),ne=B(()=>C("div",{class:"title-vertical_line f-mt"},"阴影率分析",-1)),se=F({__name:"index",setup(e){z(te),D(["1","2"]);const a=D(j().format("YYYY-MM-DD")),t=D(420),o=L(()=>Math.floor(t.value/60)),l=L(()=>Math.floor(t.value%60));x.on("changeShadows",k=>{const u=k.shadowTime;t.value=u.getHours()*60+u.getMinutes()}),H(()=>{R(a.value),d()});const d=()=>{w(a.value,o.value,l.value)},y=()=>{E(a.value)},m=()=>{$()},i=()=>{P(a.value,o.value,l.value)},_=()=>{A()};return(k,u)=>{const I=p("mars-date-picker"),g=p("a-form-item"),N=p("mars-slider"),h=p("mars-button"),M=p("a-space"),O=p("a-form"),V=p("mars-dialog");return J(),W(V,{title:"日照分析",right:"10",top:"60",width:"330"},{default:r(()=>[oe,n(O,{"label-col":{span:6},"wrapper-col":{span:18}},{default:r(()=>[n(g,{label:"日期选择:"},{default:r(()=>[n(I,{value:a.value,"onUpdate:value":u[0]||(u[0]=b=>a.value=b),valueFormat:"YYYY-MM-DD"},null,8,["value"])]),_:1}),n(g,{label:"时间选择:"},{default:r(()=>[n(N,{onChange:d,value:t.value,"onUpdate:value":u[1]||(u[1]=b=>t.value=b),min:0,max:1440,step:1},null,8,["value"])]),_:1}),n(g,{label:"当前时间:"},{default:r(()=>[C("span",null,S(a.value)+" "+S(o.value)+" 时 "+S(l.value)+"分",1)]),_:1}),n(g,{label:"自动播放:"},{default:r(()=>[n(M,null,{default:r(()=>[n(h,{class:"play_btn",onClick:i},{default:r(()=>[v("播放")]),_:1}),n(h,{class:"play_btn",onClick:_},{default:r(()=>[v("暂停")]),_:1})]),_:1})]),_:1})]),_:1}),ne,n(M,null,{default:r(()=>[n(h,{class:"btn",onClick:y},{default:r(()=>[v("绘制面")]),_:1}),n(h,{class:"btn",danger:"",onClick:m},{default:r(()=>[v("清除")]),_:1})]),_:1})]),_:1})}}}),pe=U(se,[["__scopeId","data-v-c0775c19"]]);export{pe as default};
